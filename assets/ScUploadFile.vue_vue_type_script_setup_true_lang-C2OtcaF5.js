import{v as e,w as a,x as t,u as s,$ as l,U as r,M as i,H as o,Q as n,f as u,o as d,g as c,D as p,q as v,J as m,A as f,W as g,E as y,C as _,F as h,y as b,I as x}from"./lucide-vue-next-DYmFLWJU.js";import{_ as k}from"./Card.vue_vue_type_script_setup_true_lang-bjhPCac0.js";import{_ as j}from"./ScButton.vue_vue_type_script_setup_true_lang-BX58BrIO.js";import{_ as z}from"./ScTag.vue_vue_type_script_setup_true_lang-Bc1RbIhV.js";import{S as w,D as C}from"./store-module/admin/service-B8wAbs3A.js";import{u as S,i as E}from"./fileType-CFRelH7y.js";import{u as A}from"./store-global/deviceStore-KKN3G4DG.js";import{_ as D}from"./ScSelector.vue_vue_type_script_setup_true_lang-5nAo2qJC.js";import{J as $,X as F,l as I}from"./vendor-lucide-DYSNolYz.js";const L={class:"text-gray-500 mx-auto flex items-center justify-center gap-2"},T={class:"flex gap-2 items-center"},U={class:"grid grid-cols-1 md:grid-cols-4 gap-4"},V={class:"text-center px-2 break-all"},B={key:0},J=["onClick","title"],q={class:"relative h-28 rounded-lg border border-gray overflow-hidden shadow-sm flex items-center justify-center cursor-pointer"},H=e({__name:"ScUploadFile",props:{typeid:{type:Number,default:0},loadFiles:{type:Array,default:()=>[]}},emits:["uploaded"],setup(e,{emit:H}){const{t:M}=a(),N=S(M),P=e,Q=H,R=A(),W=t([]),G=t(null),K=t(!1),O=t(!1),X=t([]),Y=s(),Z=t([]);l(async()=>{const e=await C({types:"1,2,3,4,5,7,8",page:1,limit:999});Z.value=e.data.data.list.map(e=>({value:e.id,label:e.filename,size:e.size,name:e.filename,id:e.id}))});const ee=r(()=>N[P.typeid]||M("nav.wen-jian")),ae=()=>{G.value?.click()},te=e=>{const a=e.target.files;a&&le(Array.from(a))},se=e=>{const a=e.dataTransfer?.files;a&&le(Array.from(a))},le=async e=>{for(const a of e){Y.info(M("t.zheng-zai-shang-chuan-filetypelabelvalue",[ee.value])),W.value.push({name:a.name,id:0,size:a.size,state:!1,progress:0,totalChunks:0});const e=W.value.length-1;O.value=!0,w(a,P.typeid,15728640,(a,t)=>{W.value[e].progress=a,W.value[e].totalChunks=t}).then(a=>{200!==a.data.code?(Y.error(a.data.msg||"上传失败"),W.value.splice(e,1)):(W.value[e].state=!0,W.value[e].id=a.data.data.id,Y.success("成功"),re())}).catch(()=>{Y.error("失败"),W.value.splice(e,1)}).finally(()=>{W.value.every(e=>!0===e.state)&&(O.value=!1)})}X.value=X.value.filter((e,a,t)=>a===t.findIndex(a=>a.file.name===e.file.name&&a.file.size===e.file.size)),re()},re=()=>{const e=W.value.filter((e,a,t)=>a===t.findIndex(a=>a.name===e.name&&a.size===e.size));Q("uploaded",e.map(e=>e.id))},ie=()=>{K.value=!1},oe=t(null),ne=e=>{oe.value&&!oe.value.contains(e.target)&&ie()},ue=e=>{"Escape"===e.key&&ie()};return i(()=>{G.value=null,X.value=[],document.removeEventListener("click",ne),document.removeEventListener("keydown",ue)}),o(()=>{W.value=(P.loadFiles||[]).map(e=>({...e,state:!0,progress:0,totalChunks:0})),n(()=>{document.addEventListener("click",ne),document.addEventListener("keydown",ue)})}),(e,a)=>(d(),u("div",{ref_key:"uploadCardRef",ref:oe},[c(k,{class:"p-6"},{default:p(()=>[v("div",L,[m(f(e.$t("b.tuo-dong"))+" ",1),c(z,{size:"sm",status:"info"},{default:p(()=>[m(f(ee.value),1)]),_:1}),m(" "+f(e.$t("b.dao-xu-xian-kuang-huo-dian-ji-shang-chuan")),1)]),v("div",T,[v("span",null,f(e.$t("f.xuan-ze-wen-jian")),1),c(D,{class:"flex-1",modelValue:W.value,"onUpdate:modelValue":a[0]||(a[0]=e=>W.value=e),options:Z.value,multiple:"",searchable:""},null,8,["modelValue","options"])]),v("div",{class:y(["border-2 border-dashed border-gray rounded-xltext-center cursor-pointer hover:border-blue-400 transition",{"p-10":2==_(R).device,"p-2":1==_(R).device}]),onDragover:a[2]||(a[2]=g(()=>{},["prevent"])),onDrop:g(se,["prevent"]),onClick:ae},[v("input",{ref_key:"fileInput",ref:G,type:"file",multiple:"",class:"hidden",onChange:te},null,544),v("div",U,[(d(!0),u(h,null,b(W.value,(t,s)=>(d(),u("div",{key:s,class:"relative px-6 min-h-28 rounded-lg border border-gray overflow-hidden shadow-sm flex items-center justify-center cursor-pointer",onClick:a[1]||(a[1]=g(()=>{},["stop"]))},[c(j,{icon:t.state?_(E)[P.typeid]:_($),iconSize:2==_(R).device?36:24,noBg:"",noPd:""},null,8,["icon","iconSize"]),v("div",null,[v("div",V,f(t.name),1),t.state?x("",!0):(d(),u("div",B," 上传中...("+f(t.progress)+"/"+f(t.totalChunks)+") ",1))]),v("button",{onClick:g(e=>(e=>{X.value.splice(e,1),W.value.splice(e,1),G.value.value=""})(s),["stop"]),class:"absolute top-1 right-1 w-8 h-8 bg-white/70 hover:bg-white text-red-500 rounded-full p-1 shadow cursor-pointe",title:e.$t("b.shan-chu")},[c(_(F))],8,J)]))),128)),v("div",q,[c(_(I),{size:36})])])],34)]),_:1})],512))}});export{H as _};
