import{v as e,U as a,x as o,B as l,o as i,D as t,q as s,g as n,E as c,A as u,C as r,a4 as d,a5 as v,M as g,W as b,f as p,I as f,z as h,a6 as m,c as y,a7 as C,a8 as k,a9 as w,aa as _,ab as x,e as M,H as z,ac as S,ad as P,ae as A,af as V,ag as B,ah as T,ai as L,aj as j,ak as U,al as R,am as H,an as I,ao as D,ap as F,aq as N,ar as E,as as O,at as q,au as W,N as Y,Y as J,av as X,J as G,aw as K,ax as Q}from"./lucide-vue-next-DYmFLWJU.js";import{S as Z,k as $}from"./store-module/admin/service-B8wAbs3A.js";import{_ as ee}from"./Card.vue_vue_type_script_setup_true_lang-bjhPCac0.js";import{_ as ae}from"./ScButton.vue_vue_type_script_setup_true_lang-BX58BrIO.js";import{_ as oe}from"./ScModal.vue_vue_type_script_setup_true_lang-BZwKgEH6.js";import{_ as le}from"./ScInput.vue_vue_type_script_setup_true_lang-BGlwauwP.js";import{u as ie}from"./store-module/post/postStore-7aBFqooK.js";import{X as te,a4 as se,a5 as ne,a6 as ce,a7 as ue,a8 as re,a9 as de,aa as ve,ab as ge,ac as be,ad as pe,ae as fe,af as he,ag as me,ah as ye,ai as Ce,aj as ke}from"./vendor-lucide-DYSNolYz.js";const we=e({__name:"CodeBlockView",props:{decorations:{},selected:{type:Boolean},updateAttributes:{type:Function},deleteNode:{type:Function},node:{},view:{},getPos:{type:Function},innerDecorations:{},editor:{},extension:{},HTMLAttributes:{}},setup(e){const g=e,b=a(()=>g.node.textContent||""),p=o("复制"),f=()=>{navigator.clipboard.writeText(b.value),p.value="复制成功",setTimeout(()=>{p.value="复制"},2e3)};return(e,a)=>(i(),l(r(v),{as:"div",class:"code-block-container relative"},{default:t(()=>[s("button",{class:"absolute top-2 right-2 z-2 border rounded-md px-2 py-1 text-sm bg-gray text-gray-content hover:bg-gray-200 hover:text-active-content transition-colors",onClick:f},[s("span",{class:c({"":"复制"===p.value,"text-green-500":"复制成功"===p.value})},u(p.value),3)]),n(r(d),{as:"pre",class:"language-"})]),_:1}))}}),_e=e({__name:"TableView",props:{decorations:{},selected:{type:Boolean},updateAttributes:{type:Function},deleteNode:{type:Function},node:{},view:{},getPos:{type:Function},innerDecorations:{},editor:{},extension:{},HTMLAttributes:{}},setup(e){const a=e,c=o(null),u=o(null),m=o(!1),y=o(0),C=o(0),k=()=>{a.editor?.chain()?.focus()?.addRowAfter()?.run(),M()},w=()=>{a.editor?.chain()?.focus()?.addColumnAfter()?.run(),M()},_=()=>{try{a.editor?.chain()?.focus()?.deleteRow()?.run()}catch(e){}M()},x=()=>{a.editor?.chain().focus().deleteTable().run(),M()},M=()=>{m.value=!1},z=e=>{if(e.preventDefault(),c.value){const a=c.value.getBoundingClientRect();y.value=e.clientX-a.left,C.value=e.clientY-a.top}else y.value=e.clientX,C.value=e.clientY;m.value=!0},S=e=>{if(!m.value)return;const a=e.target;u.value&&u.value.contains(a)||M()};return document.addEventListener("click",S),g(()=>{document.removeEventListener("click",S)}),(e,a)=>(i(),l(r(v),{as:"div",class:"w-full relative"},{default:t(()=>[s("button",{class:"absolute top-3 right-[-10px] z-2 rounded-full flex justify-center items-center w-6 h-6 bg-background border border-gray text-gray-content hover:bg-gray-200 transition-colors",onClick:w}," + "),s("button",{class:"absolute top-[38px] left-[-10px] z-2 rounded-full flex justify-center items-center w-6 h-6 bg-background border border-gray text-gray-content hover:bg-gray-200 transition-colors",onClick:k}," + "),s("div",{class:"tableWrapper",ref_key:"wrapperRef",ref:c,onContextmenu:b(z,["prevent"])},[n(r(d),{as:"table",class:"w-full table-auto border-collapse"}),m.value?(i(),p("div",{key:0,ref_key:"menuRef",ref:u,style:h({left:y.value+"px",top:C.value+"px"}),class:"absolute z-50 bg-white border rounded shadow p-2"},[s("button",{class:"block w-full text-left px-2 py-1 hover:bg-gray-100",onClick:k}," 添加行 "),s("button",{class:"block w-full text-left px-2 py-1 hover:bg-gray-100",onClick:w}," 添加列 "),s("button",{class:"block w-full text-left px-2 py-1 hover:bg-gray-100",onClick:_}," 删除行 "),s("button",{class:"block w-full text-left px-2 py-1 hover:bg-gray-100",onClick:x}," 删除表格 ")],4)):f("",!0)],544)]),_:1}))}}),xe=m.create({name:"video",group:"block",atom:!0,addAttributes:()=>({src:{default:null},width:{default:"100%"},height:{default:"auto"}}),parseHTML:()=>[{tag:"video"}],renderHTML:({HTMLAttributes:e})=>["video",{controls:"true",...e}],addCommands(){return{setVideo:e=>({commands:a})=>a.insertContent({type:this.name,attrs:e})}}}),Me={class:"flex gap-2 items-center"},ze={class:"flex gap-2 items-center"},Se={class:"flex gap-1 w-full flex-wrap"},Pe=e({__name:"TipTap",props:{modelValue:{},shadow:{type:Boolean},isMobile:{type:Boolean}},emits:["update:modelValue"],setup(e,{emit:a}){const u=y();u.register("javascript",C),u.register("typescript",k),u.register("css",w),u.register("html",_),u.register("python",x),u.register("csharp",M);const d=e,v=a,b=o(),h=o(null),m=o("javascript"),Pe=o(!1),Ae=o(""),Ve=o(""),Be=o(!1),Te=o(""),Le=ie().uploadImageMap,je=()=>{h.value?.click()},Ue=d.isMobile?18:22,Re=async e=>{const a=e.target.files;if(a&&a.length){for(const e of Array.from(a)){const a=await Z(e,6),o=$(a.data.data?.url),l=URL.createObjectURL(e);Le[l]=a.data.data?.url,o&&b.value?.chain().focus().setImage({src:l}).run()}e.target.value=""}},He=async e=>{const a=await Z(e,6),o=$(a.data.data?.url),l=URL.createObjectURL(e);return Le[l]=o,l},Ie=()=>b.value?.chain().focus().toggleBold().run(),De=()=>b.value?.chain().focus().toggleItalic().run(),Fe=()=>b.value?.chain().focus().toggleUnderline().run(),Ne=e=>b.value?.chain().focus().toggleHeading({level:e}).run(),Ee=()=>b.value?.chain().focus().toggleBulletList().run(),Oe=()=>b.value?.chain().focus().toggleOrderedList().run(),qe=()=>b.value?.chain().focus().toggleBlockquote().run(),We=()=>b.value?.chain().focus().toggleCodeBlock().run(),Ye=()=>{b.value?.chain().focus().insertTable({rows:3,cols:3,withHeaderRow:!0}).run()},Je=()=>b.value?.chain().focus().undo().run(),Xe=()=>b.value?.chain().focus().redo().run(),Ge=()=>{b.value?.chain().focus().mergeCells().run()},Ke=()=>{b.value?.chain().focus().setNode("codeBlock",{language:m.value}).run()},Qe=()=>{Pe.value=!0;const e=b.value?.state;if(e){const{from:a,to:o}=e.selection,l=e.doc.textBetween(a,o," ");Ve.value=l||""}else Ve.value="";const a=b.value?.getAttributes("link")||{};Ae.value=a.href||""},Ze=()=>{Pe.value=!1},$e=()=>{if(!b.value)return Ze();const e=Ae.value,a=Ve.value||e,{state:o,view:l}=b.value,{from:i,to:t}=o.selection;l.dispatch(o.tr.insertText(a,i,t).addMark(i,i+a.length,o.schema.marks.link.create({href:e}))),b.value&&b.value.chain().focus().setTextSelection(i+a.length).run(),Ze()},ea=()=>{Be.value=!0,Te.value=""},aa=()=>{Be.value=!1},oa=()=>{Te.value&&b.value?.chain().focus().insertContent({type:"video",attrs:{src:Te.value,controls:!0,width:"100%"}}).run(),aa()};return z(()=>{b.value=new S({extensions:[P.configure({codeBlock:!1}),A,V,B,T,L.configure({levels:[1,2,3]}),j,U,R,H.configure({resizable:!0}).extend({addNodeView:()=>W(_e)}),I,D,F,xe,N.configure({lowlight:u}).extend({addNodeView:()=>W(we)}),E.configure({inline:!1,allowBase64:!1}),O,q.configure({openOnClick:!1,autolink:!0})],content:"",autofocus:!0,onCreate({editor:e}){e.on&&e.on("table:add-row",e=>{}),e.view.dom.addEventListener("drop",async a=>{if(a.preventDefault(),a.dataTransfer?.files?.length)for(const o of a.dataTransfer.files)if(o.type.startsWith("image/")){const a=await He(o);a&&e.chain().focus().setImage({src:a}).run()}}),e.view.dom.addEventListener("paste",async a=>{if(a.clipboardData?.files?.length)for(const o of a.clipboardData.files)if(o.type.startsWith("image/")){const a=await He(o);a&&e.chain().focus().setImage({src:a}).run()}})},onUpdate({editor:e}){const a=e.state,{from:o}=a.selection;a.doc.nodeAt(o)}}),d.modelValue&&b.value.commands.setContent(d.modelValue)}),Y(b,e=>{e&&e.on("update",()=>{v("update:modelValue",e.getHTML())})}),g(()=>{b.value?.destroy()}),(a,o)=>(i(),p("div",{class:c(["tiptap-editor",{"h-[100dvh]":e.isMobile}])},[e.isMobile?(i(),l(ae,{key:0,noPd:"",class:"absolute top-[-1.7rem] left-2 w-10 h-6 pointer-events-none",icon:r(te)},null,8,["icon"])):f("",!0),s("div",{class:c(["toolbar flex gap-2 mb-2",{"flex-wrap":!e.isMobile,"overflow-x-scroll  p-2":e.isMobile}])},[n(ae,{bgClass:"bg-gray/20",onClick:Je,icon:r(se),iconSize:r(Ue),noPd:e.isMobile,class:c({"w-8 h-8":e.isMobile})},null,8,["icon","iconSize","noPd","class"]),n(ae,{bgClass:"bg-gray/20",onClick:Xe,icon:r(ne),iconSize:r(Ue),noPd:e.isMobile,class:c({"w-8 h-8":e.isMobile})},null,8,["icon","iconSize","noPd","class"]),n(ae,{bgClass:"bg-gray/20",activation:b.value?.isActive("bold"),onClick:Ie,icon:r(ce),iconSize:r(Ue),noPd:e.isMobile,class:c({"w-8 h-8":e.isMobile})},null,8,["activation","icon","iconSize","noPd","class"]),n(ae,{bgClass:"bg-gray/20",activation:b.value?.isActive("italic"),onClick:De,icon:r(ue),iconSize:r(Ue),noPd:e.isMobile,class:c({"w-8 h-8":e.isMobile})},null,8,["activation","icon","iconSize","noPd","class"]),n(ae,{bgClass:"bg-gray/20",onClick:Fe,activation:b.value?.isActive("underline"),icon:r(re),iconSize:r(Ue),noPd:e.isMobile,class:c({"w-8 h-8":e.isMobile})},null,8,["activation","icon","iconSize","noPd","class"]),n(ae,{bgClass:"bg-gray/20",onClick:o[0]||(o[0]=e=>Ne(1)),activation:b.value?.isActive("heading",{level:1}),icon:r(de),iconSize:r(Ue),noPd:e.isMobile,class:c({"w-8 h-8":e.isMobile})},null,8,["activation","icon","iconSize","noPd","class"]),n(ae,{bgClass:"bg-gray/20",onClick:o[1]||(o[1]=e=>Ne(2)),activation:b.value?.isActive("heading",{level:2}),icon:r(ve),iconSize:r(Ue),noPd:e.isMobile,class:c({"w-8 h-8":e.isMobile})},null,8,["activation","icon","iconSize","noPd","class"]),n(ae,{bgClass:"bg-gray/20",onClick:o[2]||(o[2]=e=>Ne(3)),activation:b.value?.isActive("heading",{level:3}),icon:r(ge),iconSize:r(Ue),noPd:e.isMobile,class:c({"w-8 h-8":e.isMobile})},null,8,["activation","icon","iconSize","noPd","class"]),n(ae,{bgClass:"bg-gray/20",onClick:Ee,activation:b.value?.isActive("bulletList"),icon:r(be),iconSize:r(Ue),noPd:e.isMobile,class:c({"w-8 h-8":e.isMobile})},null,8,["activation","icon","iconSize","noPd","class"]),n(ae,{bgClass:"bg-gray/20",onClick:Oe,activation:b.value?.isActive("orderedList"),icon:r(pe),iconSize:r(Ue),noPd:e.isMobile,class:c({"w-8 h-8":e.isMobile})},null,8,["activation","icon","iconSize","noPd","class"]),n(ae,{bgClass:"bg-gray/20",onClick:qe,activation:b.value?.isActive("blockquote"),icon:r(fe),iconSize:r(Ue),noPd:e.isMobile,class:c({"w-8 h-8":e.isMobile})},null,8,["activation","icon","iconSize","noPd","class"]),n(ae,{bgClass:"bg-gray/20",activation:b.value?.isActive("codeBlock"),noPd:e.isMobile,class:c({"px-2 h-8":e.isMobile})},{default:t(()=>[n(r(he),{size:r(Ue),onClick:We},null,8,["size"]),b.value?.isActive("codeBlock")?J((i(),p("select",{key:0,"onUpdate:modelValue":o[3]||(o[3]=e=>m.value=e),onChange:Ke,class:"ml-2 bg-transparent border-none outline-none"},[...o[9]||(o[9]=[s("option",{value:"javascript"},"JavaScript",-1),s("option",{value:"typescript"},"TypeScript",-1),s("option",{value:"css"},"CSS",-1),s("option",{value:"html"},"HTML",-1),s("option",{value:"python"},"Python",-1),s("option",{value:"csharp"},"C#",-1)])],544)),[[X,m.value]]):f("",!0)]),_:1},8,["activation","noPd","class"]),n(ae,{bgClass:"bg-gray/20",onClick:Ye,activation:b.value?.isActive("table"),icon:r(me),iconSize:r(Ue),noPd:e.isMobile,class:c({"w-8 h-8":e.isMobile})},null,8,["activation","icon","iconSize","noPd","class"]),n(ae,{bgClass:"bg-gray/20",onClick:je,icon:r(ye),iconSize:r(Ue),noPd:e.isMobile,class:c({"w-8 h-8":e.isMobile})},{default:t(()=>[s("input",{type:"file",multiple:"",accept:"image/*",onChange:Re,class:"hidden",ref_key:"fileInput",ref:h},null,544)]),_:1},8,["icon","iconSize","noPd","class"]),n(ae,{bgClass:"bg-gray/20",onClick:Qe,activation:b.value?.isActive("link"),icon:r(Ce),iconSize:r(Ue),noPd:e.isMobile,class:c({"w-8 h-8":e.isMobile})},null,8,["activation","icon","iconSize","noPd","class"]),n(oe,{modelValue:Pe.value,"onUpdate:modelValue":o[6]||(o[6]=e=>Pe.value=e),class:"fixed z-50 border p-4 rounded shadow"},{default:t(()=>[n(ee,null,{default:t(()=>[o[14]||(o[14]=s("h3",{class:"text-lg font-bold"},"插入超链接",-1)),s("div",Me,[o[10]||(o[10]=s("span",null,"显示文本",-1)),n(le,{modelValue:Ve.value,"onUpdate:modelValue":o[4]||(o[4]=e=>Ve.value=e),placeholder:"链接显示文本（选中的文本会自动填入）",class:"mb-2"},null,8,["modelValue"])]),s("div",ze,[o[11]||(o[11]=s("span",null,"链接地址",-1)),n(le,{modelValue:Ae.value,"onUpdate:modelValue":o[5]||(o[5]=e=>Ae.value=e),placeholder:"请输入链接地址"},null,8,["modelValue"])]),n(ae,{Border:"",onClick:$e},{default:t(()=>[...o[12]||(o[12]=[G("确定",-1)])]),_:1}),n(ae,{Border:"",onClick:Ze},{default:t(()=>[...o[13]||(o[13]=[G("取消",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"]),n(ae,{bgClass:"bg-gray/20",onClick:ea,icon:r(ke),iconSize:r(Ue),noPd:e.isMobile,class:c({"w-8 h-8":e.isMobile})},null,8,["icon","iconSize","noPd","class"]),n(oe,{modelValue:Be.value,"onUpdate:modelValue":o[8]||(o[8]=e=>Be.value=e),class:"fixed z-50 border p-4 rounded shadow"},{default:t(()=>[n(ee,null,{default:t(()=>[n(le,{modelValue:Te.value,"onUpdate:modelValue":o[7]||(o[7]=e=>Te.value=e),placeholder:"请输入视频链接"},null,8,["modelValue"]),n(ae,{Border:"",onClick:oa},{default:t(()=>[...o[15]||(o[15]=[G("确定",-1)])]),_:1}),n(ae,{Border:"",onClick:aa},{default:t(()=>[...o[16]||(o[16]=[G("取消",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])],2),n(r(K),{editor:b.value,class:c(["editor-content",{mobileTipTap:e.isMobile}])},null,8,["editor","class"]),b.value&&!b.value.isActive("imageResize")?(i(),l(r(Q),{key:1,editor:b.value,tippyOptions:{duration:100}},{default:t(()=>[n(ee,{class:"flex gap-1 w-full"},{default:t(()=>[s("div",Se,[n(ae,{bgClass:"bg-gray/20",activation:b.value?.isActive("bold"),onClick:Ie,icon:r(ce)},null,8,["activation","icon"]),n(ae,{bgClass:"bg-gray/20",activation:b.value?.isActive("italic"),onClick:De,icon:r(ue)},null,8,["activation","icon"]),n(ae,{bgClass:"bg-gray/20",onClick:Fe,activation:b.value?.isActive("underline"),icon:r(re)},null,8,["activation","icon"]),n(ae,{bgClass:"bg-gray/20",onClick:Qe,activation:b.value?.isActive("link"),icon:r(Ce)},null,8,["activation","icon"]),b.value?.isActive("table")?(i(),l(ae,{key:0,bgClass:"bg-gray/20 ",onClick:Ge},{default:t(()=>[...o[17]||(o[17]=[G("合并",-1)])]),_:1})):f("",!0)])]),_:1})]),_:1},8,["editor"])):f("",!0)],2))}});export{Pe as _};
