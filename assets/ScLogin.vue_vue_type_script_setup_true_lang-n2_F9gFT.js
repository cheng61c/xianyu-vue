import{v as e,w as l,x as a,u as s,G as t,M as o,H as n,Q as c,f as i,o as u,F as d,B as r,I as p,C as m,R as v,D as g,g as h,E as f,A as y,W as x,q as b,V as w,J as _,Y as k,_ as $}from"./lucide-vue-next-Cfi51zEF.js";import{_ as z}from"./ScButton.vue_vue_type_script_setup_true_lang-Ef9ZHzzG.js";import{_ as V}from"./Card.vue_vue_type_script_setup_true_lang-CKUt07f3.js";import{z as j,aB as C,I as L,k as I,aC as S,aD as q}from"./store-module/admin/service-Dq4pkIEc.js";import{u as U}from"./store-module/user/userStore-8LCsejjm.js";import{_ as B}from"./Avatar.vue_vue_type_script_setup_true_lang-Cq1EuCfW.js";import{v as E}from"./verify-CgysHlmG.js";import{u as P}from"./store-global/deviceStore-KmV5dTi1.js";import{a2 as M,a3 as A,u as D}from"./vendor-lucide-BLqUBl1f.js";import{_ as R}from"./ScModal.vue_vue_type_script_setup_true_lang-Go71FWDS.js";import{_ as K}from"./ScInput.vue_vue_type_script_setup_true_lang-mHghoQCQ.js";const F={key:0},G=e({__name:"ScUserCard",setup(e){const{t:w}=l(),_=P(),k=a(!1),$=s(),C=U(),L=t(),I=()=>{C.isLogin=!1,j().then(()=>{C.token="",C.userInfo={},C.autoLogin=!1,$.success(w("t.deng-chu-cheng-gong")),S()}).catch(()=>{$.error(w("t.deng-chu-shi-bai"))})},S=()=>{k.value=!1},q=a(null),A=e=>{q.value&&!q.value.contains(e.target)&&S()},D=e=>{"Escape"===e.key&&S()};return o(()=>{document.removeEventListener("click",A)}),n(()=>{c(()=>{document.addEventListener("click",A),document.addEventListener("keydown",D)})}),(e,l)=>(u(),i(d,null,[m(C).isLogin?(u(),r(z,{key:0,shadow:!1,size:"small",onClick:l[0]||(l[0]=x(e=>(()=>{if(1==_.device)return L.push({name:"user"}),void S();k.value=!k.value})(),["stop"])),hoverable:"",class:"relative flex items-center justify-center gap-2"},v({icon:g(()=>[h(B,{src:m(C).userInfo.headImg,alt:m(C).userInfo.nickname},null,8,["src","alt"])]),default:g(()=>[2==m(_).device?(u(),i("span",F,y(m(C).userInfo.nickname),1)):p("",!0)]),_:2},[2==m(_).device?{name:"endIcon",fn:g(()=>[h(m(M),{class:f(["transition-all",{"rotate-180":!k.value}])},null,8,["class"])]),key:"0"}:void 0]),1024)):p("",!0),k.value?(u(),i("div",{key:1,class:"absolute z-50",ref_key:"userCard",ref:q},[h(V,{noPg:"",class:"overflow-hidden"},{default:g(()=>[b("div",{class:"cursor-pointer px-4 py-2 hover:bg-active hover:text-active-content",onClick:l[1]||(l[1]=l=>(e.$router.push("/user/panel"),S()))},y(e.$t("b.ge-ren-zhu-ye")),1),m(E)([1,2,3,4,5,6,7])?(u(),i("div",{key:0,class:"cursor-pointer px-4 py-2 hover:bg-active hover:text-active-content",onClick:l[2]||(l[2]=l=>(e.$router.push("/admin/panel"),S()))},y(e.$t("b.hou-tai-guan-li")),1)):p("",!0),l[3]||(l[3]=b("div",{class:"border border-gray/60"},null,-1)),b("div",{class:"cursor-pointer text-error px-4 py-2 hover:bg-error hover:text-active-content",onClick:I},y(e.$t("b.deng-chu")),1)]),_:1})],512)):p("",!0)],64))}}),H={key:0,class:"flex gap-4 items-center justify-between px-3"},J={key:1,class:"flex gap-4 items-center justify-between px-3"},Q={key:2},W={class:"flex h-full justify-center"},Y={key:0,class:"flex-1"},Z={class:"flex justify-between items-end"},N={class:"label"},O={class:"w-full mb-4"},T={class:"label py-1"},X={class:"w-full mb-6"},ee={class:"label py-1"},le={class:"w-full mb-4 flex justify-between items-center"},ae={class:"label cursor-pointer"},se={class:"label-text"},te={class:"label-text text-active"},oe={class:"modal-action mt-2"},ne={class:"flex justify-between items-end"},ce={class:"label"},ie={class:"w-full mb-4"},ue={class:"label py-1"},de={class:"label pl-2"},re={class:"w-full mb-4"},pe={class:"label py-1"},me={class:"label pl-2"},ve={class:"w-full mb-6"},ge={class:"label py-1"},he={class:"w-full mb-6"},fe={class:"label py-1"},ye={class:"flex gap-2 items-center"},xe={class:"modal-action mt-2"},be={class:"flex justify-between items-end"},we={class:"label"},_e={class:"w-full mb-4"},ke={class:"label py-1"},$e={class:"w-full mb-6"},ze={class:"label py-1"},Ve={class:"w-full mb-6"},je={class:"label py-1"},Ce={class:"flex gap-2 items-center"},Le={class:"modal-action mt-2"},Ie=e({__name:"ScLogin",setup(e){const{t:o}=l(),c=P(),v=a(!1),j=a(!1),B=a(o("f.huo-qu-yan-zheng-ma")),E=a(!1),M=s(),F=t(),Ie=U();let Se=null;const qe=w({account:"",password:""}),Ue=w({account:"",email:"",password:"",captcha:"",nickname:""}),Be=w({email:"",password:"",captcha:""}),Ee=e=>{let l,a=e;l=setInterval(()=>{a>0?(B.value=o("f.timeleft-miao-hou-zhong-fa",[a]),a--):(clearInterval(l),B.value=o("f.huo-qu-yan-zheng-ma"),j.value=!1)},1e3)},Pe=a("login"),Me=e=>{Pe.value=e,Ie.showLoginModal=!0,window.history.pushState(null,"#",document.URL),window.history.pushState(null,"#",document.URL),Se=F.beforeEach((e,l,a)=>{if(Ie.showLoginModal)return Fe(),void a(!1);a(!1)})},Ae=e=>{/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)?(j.value=!0,Ee(30),C({email:e}).then(e=>{200===e.data.code&&M.success(o("t.yan-zheng-ma-yi-fa-song-dao-nin-de-you-xiang"))}).catch(e=>{M.error(e.msg),Ee(1)})):M.error(o("t.you-xiang-ge-shi-bu-zheng-que"))},De=()=>{v.value=!0,L(qe).then(e=>{if(200===e.data.code){const l=e.data.data.user;l.headImg=I(l.headImg),Ie.userInfo=l,Ie.token=e.data.data.token,M.success(o("t.deng-lu-cheng-gong")),Fe(),v.value=!1,Ie.account=qe.account,Ie.password=qe.password,Ie.autoLogin=E.value,Ie.isLogin=!0}}).catch(e=>{M.error(e.msg),v.value=!1,Ie.account="",Ie.password="",Ie.userInfo={},Ie.isLogin=!1})},Re=()=>{Ue.password.length<6||Ue.password.length>20?M.error(o("t.mi-ma-chang-du-wei-620-ge-zi-fu")):6===Ue.captcha.length&&/^\d+$/.test(Ue.captcha)?Ue.account.length<3||Ue.account.length>20?M.error(o("t.yong-hu-ming-chang-du-wei-320-ge-zi-fu")):/^[a-zA-Z0-9_]+$/.test(Ue.account)?S(Ue).then(e=>{200===e.data.code&&(M.success(o("t.zhu-ce-cheng-gong")),Pe.value="login",qe.account=Ue.account,qe.password=Ue.password,v.value=!1)}).catch(e=>{M.error(e.msg),v.value=!1}):M.error(o("t.yong-hu-ming-zhi-neng-bao-han-zi-mu-shu-zi-he-xia-hua-xian")):M.error(o("t.yan-zheng-ma-wei-6-wei-shu-zi"))},Ke=()=>{Be.password.length<6||Be.password.length>20?M.error(o("t.mi-ma-chang-du-wei-620-ge-zi-fu")):6===Be.captcha.length&&/^\d+$/.test(Be.captcha)?q(Be).then(e=>{200===e.data.code&&(M.success(o("t.mi-ma-zhong-zhi-cheng-gong")),Pe.value="login",v.value=!1)}).catch(e=>{M.error(e.msg),v.value=!1}):M.error(o("t.yan-zheng-ma-wei-6-wei-shu-zi"))},Fe=()=>{Ie.showLoginModal=!1,Se&&(Se(),Se=null)};return n(()=>{document.addEventListener("keydown",e=>{"Escape"===e.key&&Fe()})}),(e,l)=>(u(),i(d,null,[m(Ie).isLogin||2!==m(c).device?p("",!0):(u(),i("div",H,[h(z,{noPadding:"",onClick:l[0]||(l[0]=e=>Me("login"))},{default:g(()=>[_(y(e.$t("b.deng-lu")),1)]),_:1}),h(z,{noPadding:"",onClick:l[1]||(l[1]=e=>Me("register"))},{default:g(()=>[_(y(e.$t("b.zhu-ce")),1)]),_:1})])),m(Ie).isLogin||1!==m(c).device?(u(),i("div",Q,[h(G)])):(u(),i("div",J,[h(z,{noPd:"",onClick:l[2]||(l[2]=e=>Me("login")),icon:m(A),iconSize:20},null,8,["icon"])])),h(R,{modelValue:m(Ie).showLoginModal,"onUpdate:modelValue":l[22]||(l[22]=e=>m(Ie).showLoginModal=e)},{default:g(()=>[h(V,{noPg:"",class:f({"w-3xl h-[36rem]":2===m(c).device,"h-[100dvh]  w-screen rounded-none ":1===m(c).device})},{default:g(()=>[b("div",W,[2==m(c).device?(u(),i("div",Y,[...l[23]||(l[23]=[b("img",{src:"/xianyu-vue/assets/85120626_p0_master1200-DdKykKt3.jpg",alt:"titleImg",class:"w-full h-full object-cover rounded-lg"},null,-1)])])):p("",!0),b("div",{class:f({flex:2===m(c).device,"":1===m(c).device})},["login"===Pe.value?(u(),i("div",{key:0,class:f(["py-8 mx-4 flex-1 flex flex-col justify-center gap-4",{"w-[22rem]  px-4":2===m(c).device,"w-screen max-w-4xl px-8":1===m(c).device}])},[b("div",Z,[h(z,{noPd:"",onClick:l[3]||(l[3]=e=>1===m(c).device?Fe():null),icon:1===m(c).device?m(D):null,iconSize:24,class:f(["font-bold",{"text-2xl":2===m(c).device,"text-lg":1===m(c).device}])},{default:g(()=>[_(y(e.$t("b.deng-lu")),1)]),_:1},8,["icon","class"]),b("div",N,[b("span",null,y(e.$t("f.huan-mei-you-zhang-hao")),1),b("span",{class:"text-active cursor-pointer",onClick:l[4]||(l[4]=e=>Me("register"))},y(e.$t("f.qu-zhu-ce")),1)])]),b("form",{class:"flex flex-col",onSubmit:x(De,["prevent"])},[b("div",O,[b("label",T,y(e.$t("f.zhang-hao")),1),h(K,{type:"text",placeholder:e.$t("f.you-xiang-huo-yong-hu-ming"),modelValue:qe.account,"onUpdate:modelValue":l[5]||(l[5]=e=>qe.account=e)},null,8,["placeholder","modelValue"])]),b("div",X,[b("label",ee,y(e.$t("f.mi-ma")),1),h(K,{type:"password",placeholder:e.$t("f.mi-ma"),modelValue:qe.password,"onUpdate:modelValue":l[6]||(l[6]=e=>qe.password=e)},null,8,["placeholder","modelValue"])]),b("div",le,[b("label",ae,[b("span",se,y(e.$t("f.ji-zhu-wo")),1),k(b("input",{type:"checkbox",class:"checkbox",checked:"","onUpdate:modelValue":l[7]||(l[7]=e=>E.value=e)},null,512),[[$,E.value]])]),b("label",{class:"label cursor-pointer",onClick:l[8]||(l[8]=e=>Me("reset_password"))},[b("span",te,y(e.$t("f.wang-ji-mi-ma")),1)])])],32),b("div",oe,[2===m(c).device?(u(),r(z,{key:0,Border:"",class:"px-4",onClick:Fe},{default:g(()=>[_(y(e.$t("b.qu-xiao")),1)]),_:1})):p("",!0),h(z,{Border:"",activation:"",class:f(["px-4",{"w-full":1===m(c).device}]),loading:v.value,onClick:De},{default:g(()=>[_(y(e.$t("b.deng-lu")),1)]),_:1},8,["class","loading"])])],2)):p("",!0),"register"===Pe.value?(u(),i("div",{key:1,class:f(["py-8 mx-4 flex-1 flex flex-col justify-center gap-4",{"w-[22rem]  px-4":2===m(c).device,"w-screen max-w-4xl px-8":1===m(c).device}])},[b("div",ne,[h(z,{noPd:"",onClick:l[9]||(l[9]=e=>1===m(c).device?Fe():null),icon:1===m(c).device?m(D):null,iconSize:24,class:f(["font-bold",{"text-2xl":2===m(c).device,"text-lg":1===m(c).device}])},{default:g(()=>[_(y(e.$t("b.zhu-ce")),1)]),_:1},8,["icon","class"]),b("div",ce,[b("span",null,y(e.$t("f.yi-jing-you-zhang-hao")),1),b("span",{class:"text-active cursor-pointer",onClick:l[10]||(l[10]=e=>Me("login"))},y(e.$t("f.fan-hui-deng-lu")),1)])]),b("form",{class:"flex flex-col",onSubmit:x(Re,["prevent"])},[b("div",ie,[b("label",ue,y(e.$t("f.yong-hu-ming")),1),b("label",de,y(e.$t("f.yong-yu-deng-lu")),1),h(K,{type:"text",placeholder:e.$t("f.qing-shu-ru-yong-hu-ming"),modelValue:Ue.account,"onUpdate:modelValue":l[11]||(l[11]=e=>Ue.account=e)},null,8,["placeholder","modelValue"])]),b("div",re,[b("label",pe,y(e.$t("f.you-xiang")),1),b("label",me,y(e.$t("f.yong-yu-deng-lu-he-jie-shou-yan-zheng-ma")),1),h(K,{type:"email",placeholder:e.$t("d.qing-shu-ru-you-xiang"),modelValue:Ue.email,"onUpdate:modelValue":l[12]||(l[12]=e=>Ue.email=e)},null,8,["placeholder","modelValue"])]),b("div",ve,[b("label",ge,y(e.$t("f.mi-ma")),1),h(K,{type:"password",placeholder:e.$t("d.qing-shu-ru-mi-ma"),modelValue:Ue.password,"onUpdate:modelValue":l[13]||(l[13]=e=>Ue.password=e)},null,8,["placeholder","modelValue"])]),b("div",he,[b("label",fe,y(e.$t("f.yan-zheng-ma")),1),b("div",ye,[h(K,{type:"text",placeholder:e.$t("f.qing-shu-ru-you-xiang-yan-zheng-ma"),modelValue:Ue.captcha,"onUpdate:modelValue":l[14]||(l[14]=e=>Ue.captcha=e)},null,8,["placeholder","modelValue"]),h(z,{Border:"",class:"w-34",disabled:j.value,onClick:l[15]||(l[15]=e=>Ae(Ue.email)),type:"button"},{default:g(()=>[_(y(B.value),1)]),_:1},8,["disabled"])])])],32),b("div",xe,[2===m(c).device?(u(),r(z,{key:0,Border:"",class:"px-4",onClick:Fe},{default:g(()=>[_(y(e.$t("b.qu-xiao")),1)]),_:1})):p("",!0),h(z,{Border:"",activation:"",class:f(["px-4",{"w-full":1===m(c).device}]),loading:v.value,onClick:Re},{default:g(()=>[_(y(e.$t("b.zhu-ce")),1)]),_:1},8,["class","loading"])])],2)):p("",!0),"reset_password"===Pe.value?(u(),i("div",{key:2,class:f(["py-8 mx-4 flex-1 flex flex-col justify-center gap-4",{"w-[22rem]  px-4":2===m(c).device,"w-screen max-w-4xl px-8":1===m(c).device}])},[b("div",be,[h(z,{noPd:"",onClick:l[16]||(l[16]=e=>1===m(c).device?Fe():null),icon:1===m(c).device?m(D):null,iconSize:24,class:f(["font-bold",{"text-2xl":2===m(c).device,"text-lg":1===m(c).device}])},{default:g(()=>[_(y(e.$t("f.zhong-zhi-mi-ma")),1)]),_:1},8,["icon","class"]),b("div",we,[b("span",null,y(e.$t("f.xiang-qi-lai-le")),1),b("span",{class:"text-active cursor-pointer",onClick:l[17]||(l[17]=e=>Me("login"))},y(e.$t("f.fan-hui-deng-lu")),1)])]),b("form",{class:"flex flex-col",onSubmit:x(Re,["prevent"])},[b("div",_e,[b("label",ke,y(e.$t("f.you-xiang")),1),h(K,{type:"email",placeholder:e.$t("f.you-xiang"),modelValue:Be.email,"onUpdate:modelValue":l[18]||(l[18]=e=>Be.email=e)},null,8,["placeholder","modelValue"])]),b("div",$e,[b("label",ze,y(e.$t("f.xin-mi-ma")),1),h(K,{type:"password",placeholder:e.$t("f.mi-ma"),modelValue:Be.password,"onUpdate:modelValue":l[19]||(l[19]=e=>Be.password=e)},null,8,["placeholder","modelValue"])]),b("div",Ve,[b("label",je,y(e.$t("f.yan-zheng-ma")),1),b("div",Ce,[h(K,{type:"text",placeholder:e.$t("f.qing-shu-ru-yan-zheng-ma"),modelValue:Be.captcha,"onUpdate:modelValue":l[20]||(l[20]=e=>Be.captcha=e)},null,8,["placeholder","modelValue"]),h(z,{Border:"",class:"w-44 py-2",disabled:j.value,onClick:l[21]||(l[21]=e=>Ae(Be.email)),type:"button"},{default:g(()=>[_(y(B.value),1)]),_:1},8,["disabled"])])])],32),b("div",Le,[2===m(c).device?(u(),r(z,{key:0,Border:"",class:"px-4",onClick:Fe},{default:g(()=>[_(y(e.$t("b.qu-xiao")),1)]),_:1})):p("",!0),h(z,{Border:"",activation:"",class:f(["px-4",{"w-full":1===m(c).device}]),loading:v.value,onClick:Ke},{default:g(()=>[_(y(e.$t("f.que-ren-zhong-zhi")),1)]),_:1},8,["class","loading"])])],2)):p("",!0)],2)])]),_:1},8,["class"])]),_:1},8,["modelValue"])],64))}});export{Ie as _};
