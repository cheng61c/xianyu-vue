import{v as e,w as a,u as t,G as l,x as s,H as n,f as i,o,q as u,g as r,I as d,C as c,A as p,B as v,Y as g,J as b,Z as f,F as m,y as _,D as y}from"./lucide-vue-next-Cfi51zEF.js";import{a4 as x,$ as h,b as j,a2 as k}from"./store-module/admin/service-Dq4pkIEc.js";import{u as w}from"./store-module/user/userStore-8LCsejjm.js";import{u as I}from"./store-global/deviceStore-KmV5dTi1.js";import{_ as V}from"./ScButton.vue_vue_type_script_setup_true_lang-Ef9ZHzzG.js";import{_ as $}from"./ScUploadFile.vue_vue_type_script_setup_true_lang-D8nqC-4_.js";import{_ as C}from"./ScDrawer.vue_vue_type_script_setup_true_lang-BAH82y4L.js";import{_ as S}from"./TipTap.vue_vue_type_script_setup_true_lang-z5it9mjF.js";import{u as z,y as q}from"./vendor-lucide-BLqUBl1f.js";import"./store-global/configStore-BTeIPwoA.js";import"./store-module/post/postStore-D6edmGvH.js";import"./Card.vue_vue_type_script_setup_true_lang-CKUt07f3.js";import"./ScTag.vue_vue_type_script_setup_true_lang-DsxShMn2.js";import"./fileType-DRkYn7FT.js";import"./ScSelector.vue_vue_type_script_setup_true_lang-DdvKffTA.js";import"./store-global/drawerStore-BV3ZUw2h.js";import"./ScModal.vue_vue_type_script_setup_true_lang-Go71FWDS.js";import"./ScInput.vue_vue_type_script_setup_true_lang-mHghoQCQ.js";const B={class:"flex flex-col w-[100dvw] h-[100dvh] space-y-4 pb-2 overflow-y-auto"},U={class:"flex h-12 gap-2 items-center"},T={key:0,class:"text-error"},F={class:"space-y-4 text-sm px-4"},D={class:"flex flex-col w-full space-y-4 pb-2"},R={class:"flex items-center gap-2"},A=["data-tip"],L={class:"flex items-center gap-1"},M={class:"flex items-center gap-2"},O=["data-tip"],G={class:"flex items-center gap-1"},H=["placeholder"],J={class:"flex flex-col gap-2"},N=["data-tip"],Y={class:"flex items-center gap-1"},Z={class:"flex gap-2 flex-col"},E={class:"flex flex-wrap gap-2"},K={class:"flex flex-wrap gap-2"},P={class:"flex flex-wrap gap-2"},Q={key:0},W={class:"flex justify-end my-2 px-4"},X={key:0,class:"bg-background rounded-t-lg"},ee=e({__name:"MobileCreateResource",props:{post:{type:Object,default:null}},setup(e){const ee=e,{t:ae}=a(),te=t(),le=w(),se=l(),ne=s([]),ie=s({}),oe=s(!1),ue=s(!0),re=s([]),de=s(!1),ce=I(),pe=s({id:0,title:"",version:"",content:"",files:[],postId:0,gameVersionIds:[]}),ve=s(null),ge=()=>{pe.value.content=pe.value.content??"",de.value=!0},be=e=>{const a=pe.value.gameVersionIds.indexOf(e);-1===a?pe.value.gameVersionIds.push(e):pe.value.gameVersionIds.splice(a,1)},fe=e=>{pe.value.files=e},me=()=>{pe.value.title?pe.value.version?pe.value.content?pe.value.content&&pe.value.content.trim()?(0==pe.value.id&&delete pe.value.id,pe.value.content=j(pe.value.content),oe.value=!0,k[pe.value.id?"updateVersion":"createVersion"](pe.value).then(e=>{200==e.data.code&&(te.success(ae("t.ban-ben-fa-bu-cheng-gong")),pe.value={title:"",version:"",content:"",files:[],postId:0,gameVersionIds:[]},ve.value="",oe.value=!1,se.back())}).catch(e=>{te.error(ae("t.fa-bu-shi-bai")+e.msg),oe.value=!1})):te.error(ae("t.nei-rong-bu-neng-wei-kong")):te.error(ae("t.qing-shu-ru-ban-ben-nei-rong")):te.error(ae("t.qing-shu-ru-ban-ben-hao")):te.error(ae("t.qing-shu-ru-ban-ben-biao-ti"))};return n(async()=>{if(ee.post&&(pe.value.postId=ee.post.id,ie.value=ee.post),se.currentRoute.value.query.resourceId){const e=Number(se.currentRoute.value.query.resourceId),a=await x(e);if(200==a.data.code){const e=a.data.data;pe.value={id:e.id,title:e.title,version:e.version,content:e.content,files:e.files.map(e=>e.id),postId:e.postId,gameVersionIds:e.gameVersionIds||[]},pe.value.content=e.content,re.value=e.files.map(e=>({name:e.filename,id:e.id,size:+e.size})),te.success(ae("t.ban-ben-fa-bu-cheng-gong"))}ue.value=!1}else ue.value=!1;h().then(e=>{const a=e.data;200==a.code&&(ne.value=a.data)})}),(e,a)=>(o(),i(m,null,[u("div",B,[u("div",U,[r(V,{class:"",icon:c(z),iconSize:22,onClick:a[0]||(a[0]=a=>e.$router.back())},null,8,["icon"]),u("div",{class:"text-lg font-semibold",onClick:a[1]||(a[1]=a=>e.$router.back())},p(e.$t("b.bian-ji-zi-yuan")),1),c(le).isLogin?d("",!0):(o(),i("div",T,p(e.$t("d.qing-xian-deng-lu-hou-zai-fa-bu-nei-rong")),1))]),u("div",F,[u("div",D,[u("div",R,[u("label",{class:"w-24 flex justify-between items-center tooltip tooltip-right","data-tip":e.$t("d.ban-ben-hao-zi-yuan-ban-ben-hao")},[u("span",L,[b(p(e.$t("d.ban-ben-hao"))+" ",1),u("span",null,[r(c(q),{size:16})])]),a[6]||(a[6]=u("span",null,":",-1))],8,A),g(u("input",{"onUpdate:modelValue":a[2]||(a[2]=e=>pe.value.version=e),type:"text",class:"w-full max-w-md px-4 py-2 border border-gray-content rounded-lg focus:outline-none focus:ring-2 focus:ring-active",placeholder:"1.0.0"},null,512),[[f,pe.value.version]])]),u("div",M,[u("label",{class:"w-24 flex justify-between items-center tooltip tooltip-right","data-tip":e.$t("t.ban-ben-biao-ti")},[u("span",G,[b(p(e.$t("b.biao-ti"))+" ",1),u("span",null,[r(c(q),{size:16})])]),a[7]||(a[7]=u("span",null,":",-1))],8,O),g(u("input",{"onUpdate:modelValue":a[3]||(a[3]=e=>pe.value.title=e),type:"text",class:"w-full max-w-md px-4 py-2 border border-gray-content rounded-lg focus:outline-none focus:ring-2 focus:ring-active",placeholder:e.$t("d.qing-shu-ru-biao-ti")},null,8,H),[[f,pe.value.title]])]),u("div",J,[u("label",{class:"w-32 flex items-center tooltip tooltip-right","data-tip":e.$t("t.you-xi-ban-ben-yong-yu-zai-bu-tong-ban-ben-de-you-xi-zhong-zhan-shi-jian-yi-gen-ju-shi-ji-qing-kuang-xuan-ze-he-shi-de-ban-ben")},[u("span",Y,[b(p(e.$t("f.shi-pei-de-you-xi-ban-ben"))+" ",1),u("span",null,[r(c(q),{size:16})])]),a[8]||(a[8]=u("span",null,":",-1))],8,N),u("div",Z,[u("div",E,[u("span",null,p(e.$t("f.cha-jian-ban")),1),(o(!0),i(m,null,_(ne.value,e=>(o(),i(m,{key:e.id},["plugin"===e.type?(o(),v(V,{key:0,Border:"",activation:pe.value.gameVersionIds.includes(e.id),onClick:a=>be(e.id)},{default:y(()=>[b(p(e.name),1)]),_:2},1032,["activation","onClick"])):d("",!0)],64))),128))]),u("div",K,[u("span",null,p(e.$t("f.lian-ji-ban")),1),(o(!0),i(m,null,_(ne.value,e=>(o(),i(m,{key:e.id},["online"===e.type?(o(),v(V,{key:0,Border:"",activation:pe.value.gameVersionIds.includes(e.id),onClick:a=>be(e.id)},{default:y(()=>[b(p(e.name),1)]),_:2},1032,["activation","onClick"])):d("",!0)],64))),128))]),u("div",P,[u("span",null,p(e.$t("f.yuan-ban")),1),(o(!0),i(m,null,_(ne.value,e=>(o(),i(m,{key:e.id},["original"===e.type?(o(),v(V,{key:0,Border:"",activation:pe.value.gameVersionIds.includes(e.id),onClick:a=>be(e.id)},{default:y(()=>[b(p(e.name),1)]),_:2},1032,["activation","onClick"])):d("",!0)],64))),128))])])])]),ue.value?d("",!0):(o(),i("div",Q,[r($,{typeid:ie.value.fileType,loadFiles:re.value,onUploaded:fe},null,8,["typeid","loadFiles"])])),1==c(ce).device?(o(),v(V,{key:1,onClick:ge,Border:"",class:"w-full"},{default:y(()=>[b(p(e.$t("b.bian-xie-jie-shao")),1)]),_:1})):d("",!0),u("div",W,[r(V,{activation:"",disabled:!1===c(le).isLogin||oe.value,class:"px-6 py-2 hover:bg-active/80",onClick:me,loading:oe.value},{default:y(()=>[b(p(pe.value.id?e.$t("b.geng-xin-ban-ben"):e.$t("b.fa-bu-ban-ben")),1)]),_:1},8,["disabled","loading"])])])]),r(C,{modelValue:de.value,"onUpdate:modelValue":a[5]||(a[5]=e=>de.value=e),position:"bottom"},{default:y(()=>[null!==pe.value.content?(o(),i("div",X,[r(S,{modelValue:pe.value.content,"onUpdate:modelValue":a[4]||(a[4]=e=>pe.value.content=e),"is-mobile":1==c(ce).device},null,8,["modelValue","is-mobile"])])):d("",!0)]),_:1},8,["modelValue"])],64))}});export{ee as default};
