import{v as e,w as a,u as t,G as s,L as i,x as l,H as n,f as o,o as r,q as u,I as p,B as d,g as c,D as v,J as m,A as g,C as b,Y as f,Z as _,F as y,y as x,E as h}from"./lucide-vue-next-Cfi51zEF.js";import{_ as j}from"./TipTap.vue_vue_type_script_setup_true_lang-z5it9mjF.js";import{_ as I}from"./ScButton.vue_vue_type_script_setup_true_lang-Ef9ZHzzG.js";import{_ as k}from"./ScUploadFile.vue_vue_type_script_setup_true_lang-D8nqC-4_.js";import{p as w,a4 as V,$,b as z,a2 as S}from"./store-module/admin/service-Dq4pkIEc.js";import{u as C}from"./store-module/user/userStore-8LCsejjm.js";import{f as q}from"./store-module/post/service-HXTCd_Ip.js";import{_ as B}from"./Card.vue_vue_type_script_setup_true_lang-CKUt07f3.js";import{y as L}from"./vendor-lucide-BLqUBl1f.js";import"./ScModal.vue_vue_type_script_setup_true_lang-Go71FWDS.js";import"./ScInput.vue_vue_type_script_setup_true_lang-mHghoQCQ.js";import"./store-module/post/postStore-D6edmGvH.js";import"./ScTag.vue_vue_type_script_setup_true_lang-DsxShMn2.js";import"./fileType-DRkYn7FT.js";import"./store-global/deviceStore-KmV5dTi1.js";import"./ScSelector.vue_vue_type_script_setup_true_lang-DdvKffTA.js";import"./store-global/configStore-BTeIPwoA.js";const T={class:"flex flex-col w-full space-y-4 pb-2"},U={class:"flex gap-2 items-center"},F={class:"text-lg font-semibold"},N={key:0,class:"text-error"},A={class:"space-y-4 text-sm"},D={class:"flex items-center gap-2"},E=["data-tip"],G={class:"flex items-center gap-1"},H={class:"flex items-center gap-2"},J={class:"w-24 flex justify-between items-center tooltip tooltip-right","data-tip":"\n            版本标题"},M={class:"flex items-center gap-1"},O=["placeholder"],R={class:"flex items-center gap-2"},Y=["data-tip"],Z={class:"flex items-center gap-1"},K={class:"flex flex-col gap-2"},P={class:"flex flex-wrap gap-2 items-center"},Q={class:"flex flex-wrap gap-2 items-center"},W={class:"flex flex-wrap gap-2 items-center"},X={key:0},ee={class:"text-right"},ae=["data-tip","disabled"],te=e({__name:"CreateResource",setup(e){const{t:te}=a(),se=t(),ie=C(),le=s(),ne=i(),oe=l([]),re=l({}),ue=l(!1),pe=l(!0),de=l([]),ce=l({id:0,title:"",version:"",content:"",files:[],postId:0,gameVersionIds:[]}),ve=e=>{const a=ce.value.gameVersionIds.indexOf(e);-1===a?ce.value.gameVersionIds.push(e):ce.value.gameVersionIds.splice(a,1)},me=e=>{ce.value.files=e},ge=()=>{ce.value.title?ce.value.version?ce.value.content?(ce.value.content=z(ce.value.content),ue.value=!0,S[ce.value.id?"updateVersion":"createVersion"](ce.value).then(e=>{200==e.data.code&&(se.success(te("t.ban-ben-fa-bu-cheng-gong")),ce.value={title:"",version:"",content:"",files:[],postId:0,gameVersionIds:[]},ue.value=!1,le.back())}).catch(e=>{se.error(te("t.fa-bu-shi-bai")+e.msg),ue.value=!1})):se.error(te("t.qing-shu-ru-ban-ben-nei-rong")):se.error(te("t.qing-shu-ru-ban-ben-hao")):se.error(te("t.qing-shu-ru-ban-ben-biao-ti"))};return n(async()=>{if(ne.params.postId){ce.value.postId=Number(ne.params.postId);const e=await w(Number(ne.params.postId));if(200!=e.data.code)return void se.error(te("t.jia-zai-shi-bai"));re.value=e.data.data}if(ne.query.resourceId){const e=Number(ne.query.resourceId),a=await V(e);if(200==a.data.code){const e=a.data.data;ce.value={id:e.id,title:e.title,version:String(e.version),content:q(e.content),files:e.files.map(e=>e.id),postId:e.postId,gameVersionIds:e.gameVersionIds||[]},de.value=e.files.map(e=>({name:e.filename,id:e.id,size:+e.size}))}pe.value=!1}else pe.value=!1;$().then(e=>{const a=e.data;200==a.code&&(oe.value=a.data)}),ue.value=!1}),(e,a)=>(r(),o("div",T,[u("div",U,[c(I,{class:"px-4 py-1 text-sm border border-gray",onClick:a[0]||(a[0]=a=>e.$router.back())},{default:v(()=>[m(g(e.$t("b.fan-hui")),1)]),_:1}),u("div",F,g(e.$t("b.bian-ji-zi-yuan")),1),b(ie).isLogin?p("",!0):(r(),o("div",N,g(e.$t("d.qing-xian-deng-lu-hou-zai-fa-bu-nei-rong")),1))]),u("div",A,[u("div",D,[u("label",{class:"w-24 flex justify-between items-center tooltip tooltip-right","data-tip":e.$t("d.ban-ben-hao-zi-yuan-ban-ben-hao")},[u("span",G,[m(g(e.$t("b.ban-ben-hao"))+" ",1),u("span",null,[c(b(L),{size:16})])]),a[4]||(a[4]=u("span",null,":",-1))],8,E),f(u("input",{"onUpdate:modelValue":a[1]||(a[1]=e=>ce.value.version=e),type:"text",class:"w-full max-w-md px-4 py-2 border border-gray-content rounded-lg focus:outline-none focus:ring-2 focus:ring-active",placeholder:"1.0.0"},null,512),[[_,ce.value.version]])]),u("div",H,[u("label",J,[u("span",M,[m(g(e.$t("b.biao-ti"))+" ",1),u("span",null,[c(b(L),{size:16})])]),a[5]||(a[5]=u("span",null,":",-1))]),f(u("input",{"onUpdate:modelValue":a[2]||(a[2]=e=>ce.value.title=e),type:"text",class:"w-full max-w-md px-4 py-2 border border-gray-content rounded-lg focus:outline-none focus:ring-2 focus:ring-active",placeholder:e.$t("d.qing-shu-ru-biao-ti")},null,8,O),[[_,ce.value.title]])]),u("div",R,[u("label",{class:"w-24 flex justify-between items-center tooltip tooltip-right","data-tip":e.$t("t.you-xi-ban-ben-yong-yu-zai-bu-tong-ban-ben-de-you-xi-zhong-zhan-shi-jian-yi-gen-ju-shi-ji-qing-kuang-xuan-ze-he-shi-de-ban-ben")},[u("span",Z,[m(g(e.$t("f.shi-pei-de-you-xi-ban-ben"))+" ",1),u("span",null,[c(b(L),{size:16})])]),a[6]||(a[6]=u("span",null,":",-1))],8,Y),u("div",K,[u("div",P,[u("span",null,g(e.$t("f.cha-jian-ban")),1),(r(!0),o(y,null,x(oe.value,e=>(r(),o(y,{key:e.id},["plugin"===e.type?(r(),d(I,{key:0,class:"px-4 py-1 text-sm",Border:"",activation:ce.value.gameVersionIds.includes(e.id),onClick:a=>ve(e.id)},{default:v(()=>[m(g(e.name),1)]),_:2},1032,["activation","onClick"])):p("",!0)],64))),128))]),u("div",Q,[u("span",null,g(e.$t("f.lian-ji-ban")),1),(r(!0),o(y,null,x(oe.value,e=>(r(),o(y,{key:e.id},["online"===e.type?(r(),d(I,{key:0,class:"px-4 py-1 text-sm",Border:"",activation:ce.value.gameVersionIds.includes(e.id),onClick:a=>ve(e.id)},{default:v(()=>[m(g(e.name),1)]),_:2},1032,["activation","onClick"])):p("",!0)],64))),128))]),u("div",W,[u("span",null,g(e.$t("f.yuan-ban")),1),(r(!0),o(y,null,x(oe.value,e=>(r(),o(y,{key:e.id},["original"===e.type?(r(),d(I,{key:0,class:"px-4 py-1 text-sm",Border:"",activation:ce.value.gameVersionIds.includes(e.id),onClick:a=>ve(e.id)},{default:v(()=>[m(g(e.name),1)]),_:2},1032,["activation","onClick"])):p("",!0)],64))),128))])])])]),pe.value?p("",!0):(r(),o("div",X,[c(k,{typeid:re.value.fileType,loadFiles:de.value,onUploaded:me},null,8,["typeid","loadFiles"])])),pe.value?p("",!0):(r(),d(B,{key:1},{default:v(()=>[c(j,{modelValue:ce.value.content,"onUpdate:modelValue":a[3]||(a[3]=e=>ce.value.content=e)},null,8,["modelValue"])]),_:1})),u("div",ee,[u("button",{class:h(["px-6 py-2 rounded-lg",{"bg-active text-active-content hover:bg-active/80  cursor-pointer":!0===b(ie).isLogin,"bg-active/60 text-active-content/60  cursor-not-allowed tooltip tooltip-left":!1===b(ie).isLogin}]),"data-tip":e.$t("d.qing-xian-deng-lu-hou-zai-fa-bu-nei-rong"),onClick:ge,disabled:!1===b(ie).isLogin||ue.value},g(ce.value.id?e.$t("b.geng-xin-ban-ben"):e.$t("b.fa-bu-ban-ben")),11,ae)])]))}});export{te as default};
