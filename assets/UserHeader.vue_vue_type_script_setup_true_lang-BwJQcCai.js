import{v as e,w as a,U as t,x as l,X as s,f as n,o as i,q as u,I as o,P as r,A as c,W as d,E as p,F as g,y as m,g as v,C as f,u as h,N as _,D as x,J as y,aD as b,Y as w,Z as j,R as k}from"./lucide-vue-next-DYmFLWJU.js";import{k as I,f as R,S as $,aE as U}from"./store-module/admin/service-B8wAbs3A.js";import{u as C}from"./store-module/user/userStore-CYZokpSa.js";import{_ as L}from"./Avatar.vue_vue_type_script_setup_true_lang-Cb42g1o5.js";import{_ as z}from"./ScRole.vue_vue_type_script_setup_true_lang-C07R-pjc.js";import{av as B}from"./vendor-lucide-DYSNolYz.js";import{_ as S}from"./ScButton.vue_vue_type_script_setup_true_lang-BX58BrIO.js";import{_ as V}from"./ScModal.vue_vue_type_script_setup_true_lang-BZwKgEH6.js";import{_ as T}from"./Card.vue_vue_type_script_setup_true_lang-bjhPCac0.js";import{_ as D}from"./ScTag.vue_vue_type_script_setup_true_lang-Bc1RbIhV.js";import{u as E}from"./store-global/deviceStore-KKN3G4DG.js";const A={class:"file-input-container"},F=["accept","multiple"],O={class:"flex flex-col items-center justify-center gap-2 p-4 text-center"},P={class:"text-sm text-gray-600"},q={key:0},H={key:1,class:"font-medium"},W={class:"text-xs text-gray-500"},M={key:0,class:"mt-3 grid grid-cols-3 gap-2"},Z=["onClick"],J={class:"mt-1 text-xs text-gray-600 truncate"},N={key:1,class:"mt-1 text-sm text-red-600"},X=e({__name:"ScFileInput",props:{modelValue:{},accept:{default:"*"},multiple:{type:Boolean,default:!1},placeholder:{default:""},helperText:{default:""},error:{},disabled:{type:Boolean,default:!1},showPreview:{type:Boolean,default:!0}},emits:["update:modelValue"],setup(e,{expose:h,emit:_}){const{t:x}=a(),y=e,b=t(()=>y.placeholder?y.placeholder:x("d.tuo-fang-wen-jian-dao-zhe-li-huo-dian-ji-xuan-ze")),w=t(()=>y.helperText?y.helperText:x("d.zhi-chi-jpg-png-pdf-deng-ge-shi")),j=_,k=`file-input-${Math.random().toString(36).substring(2,9)}`,I=l(null),R=l(!1),$=l([]);s(()=>{$.value.forEach(e=>{URL.revokeObjectURL((e=>URL.createObjectURL(e))(e))})});const U=e=>{const a=e.target;a.files&&a.files.length>0&&S(Array.from(a.files))},C=()=>{R.value=!0},L=()=>{R.value=!1},z=e=>{R.value=!1,y.disabled||e.dataTransfer?.files&&e.dataTransfer.files.length>0&&S(Array.from(e.dataTransfer.files))},S=e=>{y.multiple?($.value=[...$.value,...e],j("update:modelValue",$.value)):($.value=[e[0]],j("update:modelValue",e[0]))};return h({clearFiles:()=>{$.value=[],I.value&&(I.value.value=""),j("update:modelValue",null)}}),(a,t)=>(i(),n("div",A,[u("input",{type:"file",id:k,class:"hidden",accept:e.accept,multiple:e.multiple,onChange:U,ref_key:"fileInput",ref:I},null,40,F),u("label",{for:k,class:p(["custom-file-label",{"border-blue-500":R.value,"border-red-500":e.error,"cursor-not-allowed":e.disabled}]),onDragover:d(C,["prevent"]),onDragleave:L,onDrop:d(z,["prevent"])},[u("div",O,[r(a.$slots,"icon",{},()=>[v(f(B),{class:"w-8 h-8 text-gray-400"})]),u("p",P,[$.value.length?(i(),n("span",H,c(a.$t("d.selectedfileslength-ge-wen-jian-yi-xuan-ze",[$.value.length])),1)):(i(),n("span",q,c(b.value),1))]),u("p",W,c(w.value),1)])],34),e.showPreview&&$.value.length?(i(),n("div",M,[(i(!0),n(g,null,m($.value,(e,a)=>(i(),n("div",{key:a,class:"relative group"},[u("button",{type:"button",onClick:e=>(e=>{$.value.splice(e,1),I.value&&(I.value.value=""),y.multiple?j("update:modelValue",$.value.length?[...$.value]:null):j("update:modelValue",null)})(a),class:"absolute top-1 right-1 p-1 bg-red-500 rounded-full opacity-0 group-hover:opacity-100 transition-opacity"},null,8,Z),u("p",J,c(e.name),1)]))),128))])):o("",!0),e.error?(i(),n("p",N,c(e.error),1)):o("",!0)]))}}),Y={class:"text-lg font-bold"},G={class:"flex items-center flex-wrap gap-2"},K={class:"text-sm text-background-content"},Q={class:"text-lg font-bold mb-4"},ee={class:"flex gap-4 justify-between"},ae={key:0,class:"w-2xl max-h-[42rem] overflow-hidden"},te={key:1,class:"flex w-full items-center justify-center text-gray-content"},le={class:"mb-4"},se={class:"block mb-2"},ne={class:"flex gap-1"},ie={key:0,class:"mb-4"},ue={class:"mb-2"},oe={key:0,class:"ml-2"},re=e({__name:"UserHeader",props:{isEdit:{type:Boolean,default:!1},userInfo:{type:Object,default:()=>({})}},emits:["updateUserInfo"],setup(e,{emit:t}){const{t:s}=a(),r=E(),d=h(),m=C(),B=l(!1),A=l(!1),F=l("#00000000"),O=l(null),P=t,q=e,H=()=>{F.value="#00000000"},W=l(null),M=l(null),Z=e=>{const a=e.target.files?.[0];if(a){const e=new FileReader;e.onload=()=>{W.value=e.result},e.readAsDataURL(a)}},J=({canvas:e})=>{if(!e)return;const a=document.createElement("canvas");a.width=e.width,a.height=e.height;const t=a.getContext("2d");t.fillStyle=F.value,t.fillRect(0,0,a.width,a.height),t.drawImage(e,0,0),a.toBlob(e=>{e&&(M.value=URL.createObjectURL(e))},"image/png")},N=async()=>{if(!q.isEdit)return;if(!m.isLogin)return;if(!B.value)return void(B.value=!0);if(!O.value)return;const{canvas:e}=O.value.getResult();if(!e)return;const a=await new Promise(a=>{e.toBlob(a,"image/png")});if(a){const e=`avatar_${Date.now()}.png`,t=new File([a],e,{type:"image/png"});A.value=!0,$(t,6).then(e=>{if(200===e.data.code){const a=e.data.data.url;U({headImg:a}).then(e=>{200===e.data.code&&(d.success(s("t.tou-xiang-geng-xin-cheng-gong")),m.userInfo.headImg=a,P("updateUserInfo"),B.value=!1,A.value=!1)}).catch(e=>{d.error(s("t.tou-xiang-geng-xin-shi-bai")+e.msg),A.value=!1})}}).catch(e=>{d.error(s("t.tou-xiang-shang-chuan-shi-bai")+e.msg),A.value=!1})}else d.error(s("t.cai-jian-hou-de-tu-pian-wei-kong"))};return _(F,()=>{if(O.value){const{canvas:e}=O.value.getResult();e&&(e=>{const a=document.createElement("canvas");a.width=e.width,a.height=e.height;const t=a.getContext("2d");t.fillStyle=F.value,t.fillRect(0,0,a.width,a.height),t.drawImage(e,0,0),a.toBlob(e=>{e&&(M.value=URL.createObjectURL(e))},"image/png")})(e)}}),(a,t)=>(i(),n(g,null,[v(T,{class:p(["stats w-full items-center",{"max-w-6xl min-w-4xl ":2==f(r).device}]),noCol:""},{default:x(()=>[v(L,{src:f(I)(e.userInfo.headImg)||"",alt:e.userInfo.nickname,size:64,onClick:N},null,8,["src","alt"]),u("div",null,[u("div",Y,c(e.userInfo.nickname),1),u("div",G,[v(D,{size:"sm",status:"info"},{default:x(()=>[y(" uid "+c(e.userInfo.id),1)]),_:1}),v(z,{user:e.userInfo,isAll:"",size:"sm"},null,8,["user"])]),u("div",K,c(a.$t("d.shang-ci-deng-lu-shi-jian-formattimeuserstoreuserinfolastlogintime",[f(R)(e.userInfo.lastLoginTime,a.$t)])),1)])]),_:1},8,["class"]),v(V,{modelValue:B.value,"onUpdate:modelValue":t[2]||(t[2]=e=>B.value=e)},{default:x(()=>[v(T,{class:p({"w-4xl":2==f(r).device})},{default:x(()=>[u("div",Q,c(a.$t("d.geng-xin-tou-xiang")),1),u("div",ee,[W.value?(i(),n("div",ae,[v(f(b),{ref_key:"cropperRef",ref:O,class:"cropper mb-4",minWidth:240,minHeight:240,background:"#fff",src:W.value,autoZoom:"","stencil-props":{aspectRatio:1,maxWidth:120,maxHeight:120},onChange:J},null,8,["src"])])):(i(),n("div",te,c(a.$t("d.qing-shang-chuan-tu-pian-wen-jian-jin-hang-cai-jian")),1)),u("div",null,[v(X,{accept:"image/*",onChange:Z,placeholder:a.$t("d.xuan-ze-tu-pian-wen-jian"),class:"mb-4"},null,8,["placeholder"]),u("div",le,[u("label",se,c(a.$t("d.bei-jing-tian-chong-se-yong-yu-gei-tou-ming-bei-jing-tian-chong-yan-se")),1),u("div",ne,[w(u("input",{type:"color","onUpdate:modelValue":t[0]||(t[0]=e=>F.value=e),class:"w-10 h-10 cursor-pointer"},null,512),[[j,F.value]]),v(S,{onClick:H},{default:x(()=>[y(c(a.$t("b.qing-chu")),1)]),_:1})])]),M.value?(i(),n("div",ie,[u("div",ue,c(a.$t("d.yu-lan-shi-ji-xiao-guo-bei-jing-mo-ren-hui-se")),1),v(L,{isLocal:"",src:M.value,alt:a.$t("d.yu-lan"),size:128},null,8,["src","alt"])])):o("",!0)])]),v(S,{onClick:N,Border:"",disabled:A.value},k({default:x(()=>[u("span",null,c(a.$t("f.ti-jiao-geng-gai")),1),A.value?(i(),n("span",oe,c(a.$t("d.zheng-zai-shang-chuan-tu-pian")),1)):o("",!0)]),_:2},[A.value?{name:"endIcon",fn:x(()=>[t[3]||(t[3]=u("span",{class:"loading loading-spinner loading-sm"},null,-1))]),key:"0"}:void 0]),1032,["disabled"]),v(S,{onClick:t[1]||(t[1]=e=>B.value=!1),Border:""},{default:x(()=>[y(c(a.$t("b.guan-bi")),1)]),_:1})]),_:1},8,["class"])]),_:1},8,["modelValue"])],64))}});export{re as _};
