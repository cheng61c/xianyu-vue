import{v as e,U as a,x as l,B as o,o as i,D as n,q as t,g as s,E as c,A as u,C as r,a4 as d,a5 as v,M as g,W as b,f as p,I as f,z as h,a6 as m,c as y,a7 as C,a8 as k,a9 as w,aa as _,ab as x,e as M,H as z,ac as S,ad as P,ae as A,af as V,ag as B,ah as T,ai as L,aj as j,ak as U,al as R,am as H,an as I,ao as D,ap as F,aq as N,ar as E,as as O,at as q,au as W,N as Y,Y as J,av as X,J as G,aw as K,ax as Q}from"./lucide-vue-next-Cfi51zEF.js";import{S as Z,k as $}from"./store-module/admin/service-Dq4pkIEc.js";import{_ as ee}from"./Card.vue_vue_type_script_setup_true_lang-CKUt07f3.js";import{_ as ae}from"./ScButton.vue_vue_type_script_setup_true_lang-Ef9ZHzzG.js";import{_ as le}from"./ScModal.vue_vue_type_script_setup_true_lang-Go71FWDS.js";import{_ as oe}from"./ScInput.vue_vue_type_script_setup_true_lang-mHghoQCQ.js";import{u as ie}from"./store-module/post/postStore-D6edmGvH.js";import{X as ne,a4 as te,a5 as se,a6 as ce,a7 as ue,a8 as re,a9 as de,aa as ve,ab as ge,ac as be,ad as pe,ae as fe,af as he,ag as me,ah as ye,ai as Ce,aj as ke}from"./vendor-lucide-BLqUBl1f.js";const we=e({__name:"CodeBlockView",props:{decorations:{},selected:{type:Boolean},updateAttributes:{type:Function},deleteNode:{type:Function},node:{},view:{},getPos:{type:Function},innerDecorations:{},editor:{},extension:{},HTMLAttributes:{}},setup(e){const g=e,b=a(()=>g.node.textContent||""),p=l("复制"),f=()=>{navigator.clipboard.writeText(b.value),p.value="复制成功",setTimeout(()=>{p.value="复制"},2e3)};return(e,a)=>(i(),o(r(v),{as:"div",class:"code-block-container relative"},{default:n(()=>[t("button",{class:"absolute top-2 right-2 z-2 border rounded-md px-2 py-1 text-sm bg-gray text-gray-content hover:bg-gray-200 hover:text-active-content transition-colors",onClick:f},[t("span",{class:c({"":"复制"===p.value,"text-green-500":"复制成功"===p.value})},u(p.value),3)]),s(r(d),{as:"pre",class:"language-"})]),_:1}))}}),_e=e({__name:"TableView",props:{decorations:{},selected:{type:Boolean},updateAttributes:{type:Function},deleteNode:{type:Function},node:{},view:{},getPos:{type:Function},innerDecorations:{},editor:{},extension:{},HTMLAttributes:{}},setup(e){const a=e,c=l(null),u=l(null),m=l(!1),y=l(0),C=l(0),k=()=>{var e,l,o,i;null==(i=null==(o=null==(l=null==(e=a.editor)?void 0:e.chain())?void 0:l.focus())?void 0:o.addRowAfter())||i.run(),M()},w=()=>{var e,l,o,i;null==(i=null==(o=null==(l=null==(e=a.editor)?void 0:e.chain())?void 0:l.focus())?void 0:o.addColumnAfter())||i.run(),M()},_=()=>{var e,l,o,i;try{null==(i=null==(o=null==(l=null==(e=a.editor)?void 0:e.chain())?void 0:l.focus())?void 0:o.deleteRow())||i.run()}catch(n){}M()},x=()=>{var e;null==(e=a.editor)||e.chain().focus().deleteTable().run(),M()},M=()=>{m.value=!1},z=e=>{if(e.preventDefault(),c.value){const a=c.value.getBoundingClientRect();y.value=e.clientX-a.left,C.value=e.clientY-a.top}else y.value=e.clientX,C.value=e.clientY;m.value=!0},S=e=>{if(!m.value)return;const a=e.target;u.value&&u.value.contains(a)||M()};return document.addEventListener("click",S),g(()=>{document.removeEventListener("click",S)}),(e,a)=>(i(),o(r(v),{as:"div",class:"w-full relative"},{default:n(()=>[t("button",{class:"absolute top-3 right-[-10px] z-2 rounded-full flex justify-center items-center w-6 h-6 bg-background border border-gray text-gray-content hover:bg-gray-200 transition-colors",onClick:w}," + "),t("button",{class:"absolute top-[38px] left-[-10px] z-2 rounded-full flex justify-center items-center w-6 h-6 bg-background border border-gray text-gray-content hover:bg-gray-200 transition-colors",onClick:k}," + "),t("div",{class:"tableWrapper",ref_key:"wrapperRef",ref:c,onContextmenu:b(z,["prevent"])},[s(r(d),{as:"table",class:"w-full table-auto border-collapse"}),m.value?(i(),p("div",{key:0,ref_key:"menuRef",ref:u,style:h({left:y.value+"px",top:C.value+"px"}),class:"absolute z-50 bg-white border rounded shadow p-2"},[t("button",{class:"block w-full text-left px-2 py-1 hover:bg-gray-100",onClick:k}," 添加行 "),t("button",{class:"block w-full text-left px-2 py-1 hover:bg-gray-100",onClick:w}," 添加列 "),t("button",{class:"block w-full text-left px-2 py-1 hover:bg-gray-100",onClick:_}," 删除行 "),t("button",{class:"block w-full text-left px-2 py-1 hover:bg-gray-100",onClick:x}," 删除表格 ")],4)):f("",!0)],544)]),_:1}))}}),xe=m.create({name:"video",group:"block",atom:!0,addAttributes:()=>({src:{default:null},width:{default:"100%"},height:{default:"auto"}}),parseHTML:()=>[{tag:"video"}],renderHTML:({HTMLAttributes:e})=>["video",{controls:"true",...e}],addCommands(){return{setVideo:e=>({commands:a})=>a.insertContent({type:this.name,attrs:e})}}}),Me={class:"flex gap-2 items-center"},ze={class:"flex gap-2 items-center"},Se={class:"flex gap-1 w-full flex-wrap"},Pe=e({__name:"TipTap",props:{modelValue:{},shadow:{type:Boolean},isMobile:{type:Boolean}},emits:["update:modelValue"],setup(e,{emit:a}){const u=y();u.register("javascript",C),u.register("typescript",k),u.register("css",w),u.register("html",_),u.register("python",x),u.register("csharp",M);const d=e,v=a,b=l(),h=l(null),m=l("javascript"),Pe=l(!1),Ae=l(""),Ve=l(""),Be=l(!1),Te=l(""),Le=ie().uploadImageMap,je=()=>{var e;null==(e=h.value)||e.click()},Ue=d.isMobile?18:22,Re=async e=>{var a,l,o;const i=e.target.files;if(i&&i.length){for(const e of Array.from(i)){const i=await Z(e,6),n=$(null==(a=i.data.data)?void 0:a.url),t=URL.createObjectURL(e);Le[t]=null==(l=i.data.data)?void 0:l.url,n&&(null==(o=b.value)||o.chain().focus().setImage({src:t}).run())}e.target.value=""}},He=async e=>{var a;const l=await Z(e,6),o=$(null==(a=l.data.data)?void 0:a.url),i=URL.createObjectURL(e);return Le[i]=o,i},Ie=()=>{var e;return null==(e=b.value)?void 0:e.chain().focus().toggleBold().run()},De=()=>{var e;return null==(e=b.value)?void 0:e.chain().focus().toggleItalic().run()},Fe=()=>{var e;return null==(e=b.value)?void 0:e.chain().focus().toggleUnderline().run()},Ne=e=>{var a;return null==(a=b.value)?void 0:a.chain().focus().toggleHeading({level:e}).run()},Ee=()=>{var e;return null==(e=b.value)?void 0:e.chain().focus().toggleBulletList().run()},Oe=()=>{var e;return null==(e=b.value)?void 0:e.chain().focus().toggleOrderedList().run()},qe=()=>{var e;return null==(e=b.value)?void 0:e.chain().focus().toggleBlockquote().run()},We=()=>{var e;return null==(e=b.value)?void 0:e.chain().focus().toggleCodeBlock().run()},Ye=()=>{var e;null==(e=b.value)||e.chain().focus().insertTable({rows:3,cols:3,withHeaderRow:!0}).run()},Je=()=>{var e;return null==(e=b.value)?void 0:e.chain().focus().undo().run()},Xe=()=>{var e;return null==(e=b.value)?void 0:e.chain().focus().redo().run()},Ge=()=>{var e;null==(e=b.value)||e.chain().focus().mergeCells().run()},Ke=()=>{var e;null==(e=b.value)||e.chain().focus().setNode("codeBlock",{language:m.value}).run()},Qe=()=>{var e,a;Pe.value=!0;const l=null==(e=b.value)?void 0:e.state;if(l){const{from:e,to:a}=l.selection,o=l.doc.textBetween(e,a," ");Ve.value=o||""}else Ve.value="";const o=(null==(a=b.value)?void 0:a.getAttributes("link"))||{};Ae.value=o.href||""},Ze=()=>{Pe.value=!1},$e=()=>{if(!b.value)return Ze();const e=Ae.value,a=Ve.value||e,{state:l,view:o}=b.value,{from:i,to:n}=l.selection;o.dispatch(l.tr.insertText(a,i,n).addMark(i,i+a.length,l.schema.marks.link.create({href:e}))),b.value&&b.value.chain().focus().setTextSelection(i+a.length).run(),Ze()},ea=()=>{Be.value=!0,Te.value=""},aa=()=>{Be.value=!1},la=()=>{var e;Te.value&&(null==(e=b.value)||e.chain().focus().insertContent({type:"video",attrs:{src:Te.value,controls:!0,width:"100%"}}).run()),aa()};return z(()=>{b.value=new S({extensions:[P.configure({codeBlock:!1}),A,V,B,T,L.configure({levels:[1,2,3]}),j,U,R,H.configure({resizable:!0}).extend({addNodeView:()=>W(_e)}),I,D,F,xe,N.configure({lowlight:u}).extend({addNodeView:()=>W(we)}),E.configure({inline:!1,allowBase64:!1}),O,q.configure({openOnClick:!1,autolink:!0})],content:"",autofocus:!0,onCreate({editor:e}){e.on&&e.on("table:add-row",e=>{}),e.view.dom.addEventListener("drop",async a=>{var l,o;if(a.preventDefault(),null==(o=null==(l=a.dataTransfer)?void 0:l.files)?void 0:o.length)for(const i of a.dataTransfer.files)if(i.type.startsWith("image/")){const a=await He(i);a&&e.chain().focus().setImage({src:a}).run()}}),e.view.dom.addEventListener("paste",async a=>{var l,o;if(null==(o=null==(l=a.clipboardData)?void 0:l.files)?void 0:o.length)for(const i of a.clipboardData.files)if(i.type.startsWith("image/")){const a=await He(i);a&&e.chain().focus().setImage({src:a}).run()}})},onUpdate({editor:e}){const a=e.state,{from:l}=a.selection;a.doc.nodeAt(l)}}),d.modelValue&&b.value.commands.setContent(d.modelValue)}),Y(b,e=>{e&&e.on("update",()=>{v("update:modelValue",e.getHTML())})}),g(()=>{var e;null==(e=b.value)||e.destroy()}),(a,l)=>{var u,d,v,g,y,C,k,w,_,x,M,z;return i(),p("div",{class:c(["tiptap-editor",{"h-[100dvh]":e.isMobile}])},[e.isMobile?(i(),o(ae,{key:0,noPd:"",class:"absolute top-[-1.7rem] left-2 w-10 h-6 pointer-events-none",icon:r(ne)},null,8,["icon"])):f("",!0),t("div",{class:c(["toolbar flex gap-2 mb-2",{"flex-wrap":!e.isMobile,"overflow-x-scroll  p-2":e.isMobile}])},[s(ae,{bgClass:"bg-gray/20",onClick:Je,icon:r(te),iconSize:r(Ue),noPd:e.isMobile,class:c({"w-8 h-8":e.isMobile})},null,8,["icon","iconSize","noPd","class"]),s(ae,{bgClass:"bg-gray/20",onClick:Xe,icon:r(se),iconSize:r(Ue),noPd:e.isMobile,class:c({"w-8 h-8":e.isMobile})},null,8,["icon","iconSize","noPd","class"]),s(ae,{bgClass:"bg-gray/20",activation:null==(u=b.value)?void 0:u.isActive("bold"),onClick:Ie,icon:r(ce),iconSize:r(Ue),noPd:e.isMobile,class:c({"w-8 h-8":e.isMobile})},null,8,["activation","icon","iconSize","noPd","class"]),s(ae,{bgClass:"bg-gray/20",activation:null==(d=b.value)?void 0:d.isActive("italic"),onClick:De,icon:r(ue),iconSize:r(Ue),noPd:e.isMobile,class:c({"w-8 h-8":e.isMobile})},null,8,["activation","icon","iconSize","noPd","class"]),s(ae,{bgClass:"bg-gray/20",onClick:Fe,activation:null==(v=b.value)?void 0:v.isActive("underline"),icon:r(re),iconSize:r(Ue),noPd:e.isMobile,class:c({"w-8 h-8":e.isMobile})},null,8,["activation","icon","iconSize","noPd","class"]),s(ae,{bgClass:"bg-gray/20",onClick:l[0]||(l[0]=e=>Ne(1)),activation:null==(g=b.value)?void 0:g.isActive("heading",{level:1}),icon:r(de),iconSize:r(Ue),noPd:e.isMobile,class:c({"w-8 h-8":e.isMobile})},null,8,["activation","icon","iconSize","noPd","class"]),s(ae,{bgClass:"bg-gray/20",onClick:l[1]||(l[1]=e=>Ne(2)),activation:null==(y=b.value)?void 0:y.isActive("heading",{level:2}),icon:r(ve),iconSize:r(Ue),noPd:e.isMobile,class:c({"w-8 h-8":e.isMobile})},null,8,["activation","icon","iconSize","noPd","class"]),s(ae,{bgClass:"bg-gray/20",onClick:l[2]||(l[2]=e=>Ne(3)),activation:null==(C=b.value)?void 0:C.isActive("heading",{level:3}),icon:r(ge),iconSize:r(Ue),noPd:e.isMobile,class:c({"w-8 h-8":e.isMobile})},null,8,["activation","icon","iconSize","noPd","class"]),s(ae,{bgClass:"bg-gray/20",onClick:Ee,activation:null==(k=b.value)?void 0:k.isActive("bulletList"),icon:r(be),iconSize:r(Ue),noPd:e.isMobile,class:c({"w-8 h-8":e.isMobile})},null,8,["activation","icon","iconSize","noPd","class"]),s(ae,{bgClass:"bg-gray/20",onClick:Oe,activation:null==(w=b.value)?void 0:w.isActive("orderedList"),icon:r(pe),iconSize:r(Ue),noPd:e.isMobile,class:c({"w-8 h-8":e.isMobile})},null,8,["activation","icon","iconSize","noPd","class"]),s(ae,{bgClass:"bg-gray/20",onClick:qe,activation:null==(_=b.value)?void 0:_.isActive("blockquote"),icon:r(fe),iconSize:r(Ue),noPd:e.isMobile,class:c({"w-8 h-8":e.isMobile})},null,8,["activation","icon","iconSize","noPd","class"]),s(ae,{bgClass:"bg-gray/20",activation:null==(x=b.value)?void 0:x.isActive("codeBlock"),noPd:e.isMobile,class:c({"px-2 h-8":e.isMobile})},{default:n(()=>{var e;return[s(r(he),{size:r(Ue),onClick:We},null,8,["size"]),(null==(e=b.value)?void 0:e.isActive("codeBlock"))?J((i(),p("select",{key:0,"onUpdate:modelValue":l[3]||(l[3]=e=>m.value=e),onChange:Ke,class:"ml-2 bg-transparent border-none outline-none"},[...l[9]||(l[9]=[t("option",{value:"javascript"},"JavaScript",-1),t("option",{value:"typescript"},"TypeScript",-1),t("option",{value:"css"},"CSS",-1),t("option",{value:"html"},"HTML",-1),t("option",{value:"python"},"Python",-1),t("option",{value:"csharp"},"C#",-1)])],544)),[[X,m.value]]):f("",!0)]}),_:1},8,["activation","noPd","class"]),s(ae,{bgClass:"bg-gray/20",onClick:Ye,activation:null==(M=b.value)?void 0:M.isActive("table"),icon:r(me),iconSize:r(Ue),noPd:e.isMobile,class:c({"w-8 h-8":e.isMobile})},null,8,["activation","icon","iconSize","noPd","class"]),s(ae,{bgClass:"bg-gray/20",onClick:je,icon:r(ye),iconSize:r(Ue),noPd:e.isMobile,class:c({"w-8 h-8":e.isMobile})},{default:n(()=>[t("input",{type:"file",multiple:"",accept:"image/*",onChange:Re,class:"hidden",ref_key:"fileInput",ref:h},null,544)]),_:1},8,["icon","iconSize","noPd","class"]),s(ae,{bgClass:"bg-gray/20",onClick:Qe,activation:null==(z=b.value)?void 0:z.isActive("link"),icon:r(Ce),iconSize:r(Ue),noPd:e.isMobile,class:c({"w-8 h-8":e.isMobile})},null,8,["activation","icon","iconSize","noPd","class"]),s(le,{modelValue:Pe.value,"onUpdate:modelValue":l[6]||(l[6]=e=>Pe.value=e),class:"fixed z-50 border p-4 rounded shadow"},{default:n(()=>[s(ee,null,{default:n(()=>[l[14]||(l[14]=t("h3",{class:"text-lg font-bold"},"插入超链接",-1)),t("div",Me,[l[10]||(l[10]=t("span",null,"显示文本",-1)),s(oe,{modelValue:Ve.value,"onUpdate:modelValue":l[4]||(l[4]=e=>Ve.value=e),placeholder:"链接显示文本（选中的文本会自动填入）",class:"mb-2"},null,8,["modelValue"])]),t("div",ze,[l[11]||(l[11]=t("span",null,"链接地址",-1)),s(oe,{modelValue:Ae.value,"onUpdate:modelValue":l[5]||(l[5]=e=>Ae.value=e),placeholder:"请输入链接地址"},null,8,["modelValue"])]),s(ae,{Border:"",onClick:$e},{default:n(()=>[...l[12]||(l[12]=[G("确定",-1)])]),_:1}),s(ae,{Border:"",onClick:Ze},{default:n(()=>[...l[13]||(l[13]=[G("取消",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"]),s(ae,{bgClass:"bg-gray/20",onClick:ea,icon:r(ke),iconSize:r(Ue),noPd:e.isMobile,class:c({"w-8 h-8":e.isMobile})},null,8,["icon","iconSize","noPd","class"]),s(le,{modelValue:Be.value,"onUpdate:modelValue":l[8]||(l[8]=e=>Be.value=e),class:"fixed z-50 border p-4 rounded shadow"},{default:n(()=>[s(ee,null,{default:n(()=>[s(oe,{modelValue:Te.value,"onUpdate:modelValue":l[7]||(l[7]=e=>Te.value=e),placeholder:"请输入视频链接"},null,8,["modelValue"]),s(ae,{Border:"",onClick:la},{default:n(()=>[...l[15]||(l[15]=[G("确定",-1)])]),_:1}),s(ae,{Border:"",onClick:aa},{default:n(()=>[...l[16]||(l[16]=[G("取消",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])],2),s(r(K),{editor:b.value,class:c(["editor-content",{mobileTipTap:e.isMobile}])},null,8,["editor","class"]),b.value&&!b.value.isActive("imageResize")?(i(),o(r(Q),{key:1,editor:b.value,tippyOptions:{duration:100}},{default:n(()=>[s(ee,{class:"flex gap-1 w-full"},{default:n(()=>{var e,a,c,u,d;return[t("div",Se,[s(ae,{bgClass:"bg-gray/20",activation:null==(e=b.value)?void 0:e.isActive("bold"),onClick:Ie,icon:r(ce)},null,8,["activation","icon"]),s(ae,{bgClass:"bg-gray/20",activation:null==(a=b.value)?void 0:a.isActive("italic"),onClick:De,icon:r(ue)},null,8,["activation","icon"]),s(ae,{bgClass:"bg-gray/20",onClick:Fe,activation:null==(c=b.value)?void 0:c.isActive("underline"),icon:r(re)},null,8,["activation","icon"]),s(ae,{bgClass:"bg-gray/20",onClick:Qe,activation:null==(u=b.value)?void 0:u.isActive("link"),icon:r(Ce)},null,8,["activation","icon"]),(null==(d=b.value)?void 0:d.isActive("table"))?(i(),o(ae,{key:0,bgClass:"bg-gray/20 ",onClick:Ge},{default:n(()=>[...l[17]||(l[17]=[G("合并",-1)])]),_:1})):f("",!0)])]}),_:1})]),_:1},8,["editor"])):f("",!0)],2)}}});export{Pe as _};
