import{v as e,w as a,x as t,N as l,f as i,o,F as s,B as n,I as u,g as r,D as d,q as c,A as v,y as m,E as p,J as g,C as h,u as b,U as f,H as x,W as y,L as k,G as _,Q as C,X as w}from"./lucide-vue-next-Cfi51zEF.js";import{_ as $,Z as z,g as j,C as I,a as q,b as D}from"./CommentInput-D498zylI.js";import{_ as A}from"./ScButton.vue_vue_type_script_setup_true_lang-Ef9ZHzzG.js";import{_ as L}from"./Avatar.vue_vue_type_script_setup_true_lang-Cq1EuCfW.js";import{_ as V}from"./ScRole.vue_vue_type_script_setup_true_lang-Bz5l_0n_.js";import{_ as B}from"./Card.vue_vue_type_script_setup_true_lang-CKUt07f3.js";import{_ as P}from"./ScTag.vue_vue_type_script_setup_true_lang-DsxShMn2.js";import{_ as S}from"./ScModal.vue_vue_type_script_setup_true_lang-Go71FWDS.js";import{_ as U}from"./EmptyState.vue_vue_type_script_setup_true_lang-Bg-k0MPd.js";import{Q as M,R as T,f as N,S as H,k as F,T as O,U as R,V as E,W as Q,X as W,Y as X,Z,w as G,_ as J}from"./store-module/admin/service-Dq4pkIEc.js";import{e as Y,o as K,D as ee,X as ae,I as te,p as le,b as ie,q as oe,r as se,s as ne,t as ue,c as re,u as de,f as ce}from"./vendor-lucide-BLqUBl1f.js";import{u as ve}from"./store-module/user/userStore-8LCsejjm.js";import{_ as me}from"./ScInput.vue_vue_type_script_setup_true_lang-mHghoQCQ.js";import{_ as pe}from"./index-CAt4bNNt.js";import{_ as ge}from"./PopupBox.vue_vue_type_script_setup_true_lang-8C3JL_QJ.js";import{v as he}from"./verify-CgysHlmG.js";import{d as be,s as fe}from"./store-module/comment/service-yDk0Yzpx.js";import{d as xe,r as ye,l as ke,i as _e,j as Ce,k as we,m as $e,n as ze,o as je}from"./store-module/post/service-HXTCd_Ip.js";import"./store-global/deviceStore-KmV5dTi1.js";import"./store-global/configStore-BTeIPwoA.js";import"./store-module/post/postStore-D6edmGvH.js";import"./zh-lang-UpYDLdiS.js";import"./en-lang-DIx6Q4dK.js";const Ie={class:"text-lg font-bold mb-2"},qe={class:"flex flex-col items-center w-4"},De=["data-tip"],Ae=["onClick"],Le={class:""},Ve={class:"text-lg font-bold mb-2"},Be={class:"text-gray-content"},Pe={class:"flex justify-end sticky top-2 h-0"},Se={class:"flex justify-between items-center"},Ue={class:"text-lg font-semibold"},Me={key:0},Te=["innerHTML"],Ne={class:"text-lg font-bold pt-2 border-t border-gray"},He={class:"flex items-center my-1 w-full"},Fe={class:"flex-[2]"},Oe={class:"break-words whitespace-pre-wrap text-wrap"},Re={class:"text-xs space-x-1"},Ee={class:"w-10 justify-end flex-wrap"},Qe={key:1},We=e({__name:"MobileReleases",props:{postData:{type:Object,required:!0}},setup(e){const{t:b}=a(),f=e,x=t(!1),y=t(null),k=t([]);return l(()=>f.postData,e=>{e&&(k.value=e.postVersions.map(e=>({...e,createdAt:N(e.createdAt,b),files:e.files.map(e=>({...e,createdAt:N(e.createdAt,b)}))})))},{immediate:!0}),(e,a)=>(o(),i(s,null,[k.value&&k.value.length>0?(o(),n(B,{key:0},{default:d(()=>[c("h3",Ie,v(e.$t("d.zi-yuan-xia-zai")),1),c("div",null,[(o(!0),i(s,null,m(k.value,(a,t)=>(o(),i("div",{class:"flex gap-x-2",key:a.id},[c("div",qe,[c("div",{class:p(["h-1/3 w-1 flex-1",{"bg-active/30":0!=t}])},null,2),c("div",{class:"bg-active h-4 w-4 rounded-full tooltip tooltip-left z-1","data-tip":a.createdAt},null,8,De),c("div",{class:p(["h-1/3 w-1 flex-1",{"bg-active/30":t!=k.value.length-1}])},null,2)]),c("div",{onClick:e=>(e=>{y.value=e,x.value=!x.value})(a),class:"flex gap-1 items-center py-2 flex-wrap"},[0==t?(o(),n(P,{key:0,size:"sm",status:"success"},{default:d(()=>[g(v(e.$t("b.zui-xin")),1)]),_:1})):u("",!0),r(P,{size:"sm",status:"info"},{default:d(()=>[g(v(a.version),1)]),_:2},1024),r(P,{size:"sm",status:"info"},{default:d(()=>[r(h(Y),{size:14,class:"mr-1"}),g(" "+v(a.files.length),1)]),_:2},1024),c("div",Le,v(a.title),1)],8,Ae)]))),128))])]),_:1})):u("",!0),k.value&&0!=k.value.length?u("",!0):(o(),n(B,{key:1,class:"mb-4"},{default:d(()=>[c("h3",Ve,v(e.$t("d.zi-yuan-xia-zai")),1),c("div",Be,v(e.$t("d.shi-mo-ye-mei-you")),1)]),_:1})),r(S,{modelValue:x.value,"onUpdate:modelValue":a[1]||(a[1]=e=>x.value=e)},{default:d(()=>[r(B,{class:"w-[95vw] max-h-[95dvh] overflow-y-auto"},{default:d(()=>{var t;return[c("div",Pe,[r(A,{class:"text-sm text-right",onClick:a[0]||(a[0]=e=>x.value=!1),icon:h(K),iconSize:"22",noBg:"",noPd:""},null,8,["icon"])]),c("div",Se,[c("h3",Ue,v(null==(t=y.value)?void 0:t.title),1)]),y.value?(o(),i("div",Me,[c("div",{class:"tiptap mb-4",innerHTML:y.value.content},null,8,Te),c("div",Ne,v(e.$t("d.wen-jian-xia-zai")),1),(o(!0),i(s,null,m(y.value.files,(e,t)=>(o(),i("div",{class:"w-full py-2 px-4 border-b border-gray",key:t},[c("div",He,[c("div",Fe,[c("div",Oe,v(e.filename),1),c("div",Re,[c("span",null,v(h(M)(e.size)),1),a[2]||(a[2]=c("span",null,"/",-1)),c("span",null,v(e.createdAt),1)])]),c("div",Ee,[r(A,{class:"text-sm text-error px-4 border hover:border-active",icon:h(ee),iconSize:16,onClick:a=>h(T).download(e.url)},null,8,["icon","onClick"])])])]))),128))])):(o(),i("div",Qe,[r(U)]))]}),_:1})]),_:1},8,["modelValue"])],64))}}),Xe={class:"w-full"},Ze={class:"flex flex-wrap gap-3"},Ge=["src"],Je={key:1,class:"skeleton w-full h-full bg-gray-200"},Ye=["onClick"],Ke={class:"comment-input flex items-end gap-2 w-full px-4 pb-4 pt-1 bg-background"},ea={key:0},aa={key:1,class:"w-2"},ta=pe(e({__name:"MobileCommentInput",props:{commentId:{type:Number,required:!1},toCommentId:{type:Number,required:!1},submitText:{type:String,default:""},placeholder:{type:String,default:""},noImg:{type:Boolean,default:!1}},emits:["submit"],setup(e,{emit:l}){const{t:n}=a(),u=b(),p=ve(),x=t(!1),y=e,k=f(()=>""==y.submitText?n("b.fa-song"):y.submitText),_=l,C=t(""),w=t(null),$=t([]),z=()=>{var e;null==(e=w.value)||e.click()},j=async e=>{const a=e.target.files;if(!a)return;u.info(n("d.zheng-zai-shang-chuan-tu-pian")),x.value=!0;const t=Array.from(a),l=[];for(const i of t){const e={url:"",viewUrl:"",loading:!0};$.value.push(e);const a=$.value.length-1,t=(async()=>{try{const e=await H(i,6),t=F(e.data.data.url);$.value[a]={url:t,viewUrl:e.data.data.viewUrl,loading:!1}}catch(e){u.error(n("t.tu-pian-shang-chuan-shi-bai-filename",[i.name])),$.value.splice(a,1)}})();l.push(t)}await Promise.allSettled(l),x.value=!1,w.value&&(w.value.value="")},I=()=>{C.value="",$.value=[]},q=()=>{if(""===C.value.trim())return void u.error(n("t.ping-lun-nei-rong-bu-neng-wei-kong"));const e=$.value.filter(e=>!e.loading).map(e=>e.url);_("submit",C.value,e,y.commentId,y.toCommentId,I)};return(a,t)=>(o(),i("div",Xe,[c("div",Ze,[(o(!0),i(s,null,m($.value,(e,a)=>(o(),i("div",{key:a,class:"relative w-20 h-20 border border-gray-300 rounded-lg overflow-hidden"},[e.loading?(o(),i("div",Je)):(o(),i("img",{key:0,src:e.viewUrl||e.url,alt:"uploaded",class:"w-full h-full object-cover"},null,8,Ge)),c("button",{class:"absolute top-0 right-0 text-active-content bg-gray/60 rounded-bl px-1 hover:bg-error/80 hover:cursor-pointer",onClick:e=>(e=>{$.value.splice(e,1)})(a)},[r(h(ae),{size:16})],8,Ye)]))),128))]),c("div",Ke,[!1===e.noImg?(o(),i("div",ea,[r(A,{icon:h(te),"icon-size":24,class:"text-sm mb-3 text-gray-content hover:text-active/80",noPd:"",disabled:!h(p).isLogin,onClick:z},null,8,["icon","disabled"]),c("input",{ref_key:"fileInput",ref:w,type:"file",accept:"image/*",multiple:"",class:"hidden",onChange:j},null,544)])):(o(),i("div",aa)),r(me,{modelValue:C.value,"onUpdate:modelValue":t[0]||(t[0]=e=>C.value=e),placeholder:h(p).isLogin?a.$t("t.qing-xie-xia-ni-de-ping-lun"):a.$t("t.qing-deng-lu-hou-ping-lun"),maxlength:500,class:"flex-1 h-full max-h-[10rem]",maxHeight:120,rows:1,disabled:"",multiline:""},null,8,["modelValue","placeholder"]),r(A,{onClick:q,activation:"",disabled:!h(p).isLogin,class:"hover:bg-active/60 py-2 mb-1.5"},{default:d(()=>[g(v(k.value),1)]),_:1},8,["disabled"])])]))}}),[["__scopeId","data-v-4757a386"]]),la={class:"text-lg font-bold"},ia={class:"flex justify-center items-center gap-4"},oa={class:"pr-8 flex flex-col"},sa={class:"text-[3.5rem] text-center"},na={class:"text-sm"},ua={class:"flex flex-col gap-2"},ra=["value"],da={class:"flex justify-between items-center"},ca={class:"text-lg font-semibold"},va={class:"flex gap-4"},ma={class:"mr-4 pt-2"},pa={class:"flex-1"},ga={class:"flex items-center justify-between gap-2 mb-2"},ha={class:"mb-2"},ba={class:"text-text-gray text-sm"},fa={class:"mb-2"},xa={key:0,class:"flex flex-wrap gap-2 mb-2"},ya=["src","onClick"],ka={class:"flex justify-end gap-4 items-center"},_a={class:"text-sm text-gray-content"},Ca={class:"flex gap-4"},wa={class:"relative w-[90vw] h-[90vh] overflow-hidden"},$a=e({__name:"MobileScore",props:{postId:{type:Number,required:!0}},setup(e){const{t:l}=a(),n=ve(),y=b(),k=e,_=t([]),C=t({averageScore:0,totalCount:0,scoreDistribution:{5:0,4:0,3:0,2:0,1:0}}),w=t({label:"",colorClass:""}),I=t(!1),q=t(0),D=t(!1),V=t(""),P=f(()=>Object.entries(C.value.scoreDistribution).sort((e,a)=>Number(a[0])-Number(e[0]))),U=e=>{const a=C.value.totalCount;return 0===a?0:e/a*100},M=()=>{O(k.postId).then(e=>{if(200==e.data.code){const a=e.data.data.list;_.value=a.map(e=>({...e,createdAt:R(e.createdAt,l),updatedAt:R(e.updatedAt,l)}))}}).catch(e=>{})},T=()=>{E(k.postId).then(e=>{if(200==e.data.code){const a=e.data.data;C.value={averageScore:a.averageScore,totalCount:a.totalCount,scoreDistribution:{5:a.scoreDistribution[5]||0,4:a.scoreDistribution[4]||0,3:a.scoreDistribution[3]||0,2:a.scoreDistribution[2]||0,1:a.scoreDistribution[1]||0}};const{colorClass:t,label:i}=j(a.totalCount,C.value,l);w.value.colorClass=t,w.value.label=i}}).catch(e=>{})},N=(e,a,t,i,o)=>{if(!n.isLogin)return void y.error(l("t.qing-xian-deng-lu"));if(q.value<=0)return void y.error(l("t.ping-fen-bu-neng-wei-kong"));const s={postId:k.postId,score:q.value,content:e,image:a.length>0?a:void 0};Q(s).then(e=>{200==e.data.code?(y.success(l("t.ping-fen-cheng-gong")),M(),T(),q.value=0,o()):y.error(e.data.msg||l("t.ping-fen-shi-bai-qing-shao-hou-zai-shi"))}).catch(e=>{y.error(l("t.ping-fen-shi-bai-qing-shao-hou-zai-shi"))})},H=(e,a)=>{const t=_.value[e];if(!n.isLogin)return void y.error(l("t.qing-xian-deng-lu"));("like"===a?W:X)(t.id).then(e=>{200===e.data.code?(t.isLiked=e.data.data.isLiked,t.isBaded=e.data.data.isBaded,t.likeCount=e.data.data.likeCount,t.badCount=e.data.data.badCount,y.success(l("t.cao-zuo-cheng-gong"))):y.error(e.data.msg||l("t.cao-zuo-shi-bai-qing-shao-hou-zai-shi"))}).catch(e=>{y.error(l("t.cao-zuo-shi-bai-qing-shao-hou-zai-shi"))})};return x(()=>{M(),T()}),(e,a)=>(o(),i("div",null,[r(B,{class:"overflow-hidden"},{default:d(()=>[c("div",null,[c("div",la,v(e.$t("d.zi-yuan-ping-fen")),1),c("div",ia,[c("div",oa,[c("div",{class:p(w.value.colorClass)},v(w.value.label),3),c("div",sa,v(C.value.averageScore.toFixed(1)),1),c("div",na,v(e.$t("d.ping-fen-ren-shu-scoresummarytotalcount",[C.value.totalCount])),1)]),c("div",ua,[(o(!0),i(s,null,m(P.value,([e,a])=>(o(),i("div",{key:e,class:"flex gap-2 items-center"},[g(v(e)+" ",1),c("progress",{class:"progress w-[10rem] h-3 bg-gray-200",value:U(a),max:"100"},null,8,ra)]))),128))])])]),r(A,{class:"text-sm text-gray-content",onClick:a[0]||(a[0]=e=>I.value=!0),noBg:"",noPd:""},{endIcon:d(()=>[r(h(le),{size:18})]),default:d(()=>[g(v(e.$t("d.gong-scorelistlength-tiao-ping-fen",[_.value.length]))+" ",1)]),_:1})]),_:1}),r(S,{modelValue:I.value,"onUpdate:modelValue":a[3]||(a[3]=e=>I.value=e)},{default:d(()=>[r(B,{class:"gap-4 h-full max-h-[90dvh] overflow-y-auto"},{default:d(()=>[c("div",da,[c("h3",ca,v(e.$t("d.ping-fen-xiang-qing")),1),r(A,{onClick:a[1]||(a[1]=e=>I.value=!1),icon:h(ae),"icon-size":24,noBg:"",noPd:""},null,8,["icon"])]),c("div",null,[c("div",va,[c("span",null,v(e.$t("d.dui-gai-zi-yuan-ping-fen")),1),r($,{value:q.value,"onUpdate:value":a[2]||(a[2]=e=>q.value=e),readonly:!1,colorClass:"bg-active",class:"mb-4"},null,8,["value"])]),r(ta,{"post-id":k.postId,onSubmit:N,submitText:"发表",placeholder:e.$t("d.dui-gai-zi-yuan-de-ping-jia-shi")},null,8,["post-id","placeholder"])]),(o(!0),i(s,null,m(_.value,(a,t)=>(o(),i("div",{key:a.id,class:"border-gray/80 py-2 flex"},[c("div",ma,[r(L,{src:a.author.headImg},null,8,["src"])]),c("div",pa,[c("div",ga,[c("div",ha,[c("p",null,v(a.author.nickname),1),c("p",ba,v(e.$t("d.fa-bu-yu-scorecreatedat",[a.createdAt]))+" "+v(a.updatedAt!=a.createdAt?e.$t("d.geng-xin-yu-scoreupdatedat",[a.updatedAt]):""),1)]),r($,{value:a.score,colorClass:"bg-active",size:"xs"},null,8,["value"])]),c("div",fa,v(a.content),1),a.image?(o(),i("div",xa,[(o(!0),i(s,null,m(a.image,(e,a)=>(o(),i("img",{key:a,src:e,alt:"评论图片",class:"w-20 h-20 object-cover rounded-md cursor-pointer",onClick:a=>(e=>{D.value=!0,V.value=e})(e)},null,8,ya))),128))])):u("",!0),c("div",ka,[c("div",_a,v(e.$t("d.zhe-dui-ni-shi-fou-you-bang-zhu")),1),c("div",Ca,[r(A,{class:p(["text-sm border",{"text-success border-success":a.isLiked,"text-gray-content border-gray":!a.isLiked}]),onClick:e=>H(t,"like"),noBg:""},{default:d(()=>[g(v(e.$t("b.shi-scorelikecount",[a.likeCount])),1)]),_:2},1032,["class","onClick"]),r(A,{class:p(["text-sm border",{"text-error border-error":a.isBaded,"text-gray-content border-gray":!a.isBaded}]),onClick:e=>H(t,"bad"),noBg:""},{default:d(()=>[g(v(e.$t("b.fou-scorebadcount",[a.badCount]))+")",1)]),_:2},1032,["class","onClick"])])])])]))),128))]),_:1})]),_:1},8,["modelValue"]),r(S,{modelValue:D.value,"onUpdate:modelValue":a[6]||(a[6]=e=>D.value=e)},{default:d(()=>[c("div",wa,[r(z,{src:V.value,onClickOutside:a[4]||(a[4]=e=>D.value=!1)},null,8,["src"]),c("button",{class:"absolute z-[10] top-[5rem] right-[5rem] rounded-full w-10 h-10 border border-error hover:border-active/80 text-error hover:text-active/80",onClick:a[5]||(a[5]=e=>D.value=!1)},[r(h(ae),{class:"mx-auto"})])])]),_:1},8,["modelValue"])]))}}),za={class:"comment-actions flex items-center text-text-gray text-sm"},ja={key:0,class:"mt-3"},Ia=e({__name:"MobileCommentReplyButton",props:{likeCount:{type:Number,required:!0},isLike:{type:Number,required:!0},commentId:{type:Number,required:!0},toCommentId:{type:Number,required:!1}},emits:["reply"],setup(e,{emit:l}){const{t:n}=a(),m=b(),f=ve(),x=e,y=t(x.likeCount??0),k=t(x.isLike??0),_=t(""),C=l,w=(e,a,t,l)=>{f.isLogin?(C("reply",e,a,t,l),_.value=""):m.error(n("t.qing-xian-deng-lu-hou-zai-fa-biao-ping-lun"))};return(a,t)=>(o(),i(s,null,[c("div",za,[r(A,{icon:h(ie),class:p(["flex items-center mr-3",{"text-error":1==k.value}]),onClick:t[0]||(t[0]=a=>((e,a)=>{if(!f.isLogin)return void m.error(n("t.qing-xian-deng-lu-hou-zai-dian-zan"));Z({id:a||e}).then(e=>{200===e.data.code&&(y.value=e.data.data.likeCount,k.value=e.data.data.liked?1:0,m.success(n("t.dian-zan-cheng-gong")))}).catch(e=>{m.error(n("t.dian-zan-shi-bai-qing-shao-hou-zai-shi")+e.msg)})})(e.commentId,e.toCommentId)),noPd:""},{default:d(()=>[c("span",null,v(y.value),1)]),_:1},8,["icon","class"]),r(A,{noPd:"",onClick:t[1]||(t[1]=a=>{return t=e.commentId,l=e.toCommentId,void(f.isLogin?_.value!==`${t}-${l||"0"}`?_.value=`${t}-${l||"0"}`:_.value="":m.error(n("t.qing-xian-deng-lu-hou-zai-fa-biao-ping-lun")));var t,l})},{default:d(()=>[g(v(a.$t("b.hui-fu-0")),1)]),_:1})]),_.value===`${e.commentId}-${e.toCommentId??0}`?(o(),i("div",ja,[r(I,{"comment-id":e.commentId,"to-comment-id":e.toCommentId,onSubmit:w,submitText:a.$t("b.fa-biao-ping-lun"),placeholder:a.$t("b.shuo-dian-shi-mo")},null,8,["comment-id","to-comment-id","submitText","placeholder"])])):u("",!0)],64))}}),qa={class:"flex"},Da={class:"text-xl mb-4 mr-4"},Aa={key:0,class:"text-error pt-1"},La={class:"flex gap-4 justify-end"},Va=e({__name:"MobileCommentMenu",props:{commentId:{type:Number,required:!0},uid:{type:Number,required:!0}},emits:["updateComment"],setup(e,{emit:l}){const{t:m}=a(),p=b(),x=ve(),y=e,k=l,_=f(()=>he([1,2,3,5,9])),C=t(!1),w=t(""),$=()=>{C.value=!C.value},z=()=>{x.isLogin?C.value&&(w.value.trim()?G({targetType:2,targetId:y.commentId,reason:w.value}).then(()=>{p.success(m("t.ju-bao-yi-ti-jiao-wo-men-hui-jin-kuai-chu-li")),C.value=!1,w.value=""}).catch(e=>{p.error(m("t.ju-bao-shi-bai")+e.msg)}):p.error(m("t.ju-bao-li-you-bu-neng-wei-kong"))):p.error(m("t.qing-xian-deng-lu-hou-zai-cao-zuo"))},j=()=>{be(m,y.commentId,()=>{k("updateComment")})};return(a,t)=>(o(),i(s,null,[r(B,{noPg:"",class:"p-2 w-28"},{default:d(()=>[r(A,{class:"w-full text-error",onClick:$},{default:d(()=>[g(v(a.$t("b.ju-bao")),1)]),_:1}),_.value||e.uid===h(x).userInfo.id?(o(),n(A,{key:0,class:"w-full text-error",onClick:j},{default:d(()=>[g(v(a.$t("b.shan-chu-ping-lun")),1)]),_:1})):u("",!0)]),_:1}),r(S,{modelValue:C.value,"onUpdate:modelValue":t[1]||(t[1]=e=>C.value=e)},{default:d(()=>[r(B,{class:"p-6 w-[90vw]"},{default:d(()=>[c("div",qa,[c("h3",Da,v(a.$t("d.ju-bao-ping-lun")),1),h(x).isLogin?u("",!0):(o(),i("div",Aa,v(a.$t("t.qing-xian-deng-lu-hou-zai-cao-zuo")),1))]),c("div",null,v(a.$t("d.ni-que-ding-yao-ju-bao-ci-ping-lun-ma-qing-ti-gong-ju-bao-li-you-wo-men-hui-jin-kuai-chu-li")),1),r(me,{class:"mt-4",multiline:"",placeholder:a.$t("d.qing-shu-ru-ju-bao-li-you"),rows:4,maxlength:200,modelValue:w.value,"onUpdate:modelValue":t[0]||(t[0]=e=>w.value=e)},null,8,["placeholder","modelValue"]),c("div",La,[r(A,{class:"px-4",onClick:z,Border:""},{default:d(()=>[g(v(a.$t("b.ti-jiao")),1)]),_:1}),r(A,{class:"px-4",onClick:$,Border:""},{default:d(()=>[g(v(a.$t("b.qu-xiao")),1)]),_:1})])]),_:1})]),_:1},8,["modelValue"])],64))}}),Ba={class:"flex justify-between items-center border-gray pb-4"},Pa={class:"text-lg"},Sa={class:"space-y-4"},Ua={class:"flex items-start gap-2"},Ma={class:"flex-1 group/one"},Ta={class:"flex items-center mb-1"},Na=["onClick"],Ha=["onClick"],Fa=["onClick"],Oa=["onClick","innerHTML"],Ra={key:0,class:"flex flex-wrap gap-2 mb-2"},Ea=["src","alt","onClick"],Qa={key:1,class:"reply-list mt-3 pl-4 border-l border-gray space-y-3"},Wa={class:"flex items-start gap-2 group/item"},Xa={class:"flex-1"},Za=["onClick"],Ga=["onClick"],Ja=["onClick"],Ya=["onClick"],Ka={class:"max-w-[calc(100vw-80px)] mb-1 overflow-wrap word-wrap"},et=["onClick"],at=["onClick","innerHTML"],tt={key:0,class:"flex flex-wrap gap-2 mb-2"},lt=["src","alt","onClick"],it={class:"text-center mt-6"},ot={class:"relative w-[100vw] h-[100dvh]"},st={class:"absolute bottom-0 left-0 right-0 bg-background flex w-full z-2"},nt=e({__name:"MobileCommentArea",props:{postData:{}},setup(e){const{t:x}=a(),k=b(),_=e,C=ve(),w=t(""),$=t(!1),j=t(""),I=f(()=>xe(x)),q=t(1),D=t(""),V=t(0),U=f(()=>T.value.page>=Math.ceil(T.value.total/T.value.limit)?x("b.dao-di-le"):x("b.jia-zai-geng-duo-ping-lun")),M=t([]),T=t({page:1,limit:10,total:0}),H=e=>{e&&($.value=!0,j.value=F(e))},O=e=>{null!=_.postData&&(T.value.page>=Math.ceil(T.value.total/T.value.limit)&&e>T.value.page||J({postId:_.postData.id,page:e,limit:T.value.limit,orderType:q.value}).then(a=>{if(200===a.data.code){const t=a.data.data.list.map(e=>(e.createdAt=N(e.createdAt,x),e.image=e.image?e.image.map(e=>F(e)):[],e.content=ye(String(e.content)),e.children=e.children.map(e=>(e.createdAt=N(e.createdAt,x),e.image=e.image?e.image.map(e=>F(e)):[],e.content=ye(e.content),e)),e));1==e?M.value=t:M.value.push(...t),T.value.total=a.data.data.total,T.value.page=a.data.data.page}}).catch(e=>{k.error(x("d.huo-qu-ping-lun-shi-bai-qing-shao-hou-zai-shi-errormsg",[e.msg]))}))},R=(e,a,t,l,i)=>{if(!C.isLogin)return void k.error(x("t.qing-xian-deng-lu-hou-zai-fa-biao-ping-lun"));if(!_.postData)return;if(""===e.trim())return void k.error(x("t.ping-lun-nei-rong-bu-neng-wei-kong"));const o={postId:_.postData.id,content:e};t&&(o.commentId=t),l&&(o.toCommentId=l),a&&a.length>0&&(o.image=a),fe(x,o,()=>{w.value="",O(1),i&&i()})};return l(()=>_.postData,e=>{e&&O(1)},{immediate:!0}),(a,t)=>(o(),i(s,null,[c("div",null,[c("div",Ba,[c("span",Pa,v(a.$t("d.ping-lun-commentspagetotal",[T.value.total])),1),r(ge,{"button-text":I.value[q.value-1].label,icon:I.value[q.value].icon},{default:d(({close:e})=>[r(B,{noPg:""},{default:d(()=>[(o(!0),i(s,null,m(I.value,a=>(o(),n(A,{key:a.value,class:"px-3 py-1 mr-2 rounded-md",activation:q.value===a.value,icon:a.icon,onClick:t=>{return l=a.value,q.value=l,T.value.page=1,O(T.value.page),e();var l}},{default:d(()=>[g(v(a.label),1)]),_:2},1032,["activation","icon","onClick"]))),128))]),_:2},1024)]),_:1},8,["button-text","icon"])]),c("div",Sa,[(o(!0),i(s,null,m(M.value,l=>{var b;return o(),i("div",{key:l.id},[c("div",Ua,[r(L,{src:l.author.headImg,alt:l.author.nickname,size:36,class:"flex-shrink-0 mt-1",onClick:y(e=>H(l.author.headImg),["stop"])},null,8,["src","alt","onClick"]),c("div",Ma,[c("div",Ta,[c("div",null,[c("div",{class:"flex gap-1 items-center",onClick:e=>a.$router.push({name:"mobileUserPanel",query:{userId:l.author.id}})},[c("span",null,v(l.author.nickname),1),l.author.id==(null==(b=e.postData)?void 0:b.author.id)?(o(),n(P,{key:0,size:"xs",bgColor:"#FFADBB"},{default:d(()=>[g(v(a.$t("b.tie-zhu")),1)]),_:1})):u("",!0)],8,Na),c("p",{class:"text-gray-content text-xs",onClick:e=>D.value=`${l.id}`},v(l.createdAt),9,Ha)]),c("div",{class:"flex flex-1 justify-end",onClick:e=>D.value=`${l.id}`},[r(ge,{position:"left",noActivation:"",noPd:"",class:p(["transition-opacity",{"opacity-100":D.value===`${l.id}`,"opacity-0 group-hover/one:opacity-100":D.value!==`${l.id}`}]),icon:h(oe)},{default:d(()=>[r(Va,{onUpdateComment:t[0]||(t[0]=e=>O(1)),"comment-id":l.id,uid:l.author.id},null,8,["comment-id","uid"])]),_:2},1032,["class","icon"])],8,Fa)]),c("div",{class:"mb-2 w-full break-all",onClick:e=>D.value=`${l.id}`,innerHTML:l.content},null,8,Oa),l.image?(o(),i("div",Ra,[(o(!0),i(s,null,m(l.image,(e,t)=>(o(),i("img",{key:t,src:e,alt:a.$t("d.ping-lun-tu-pian"),class:"w-20 h-20 object-cover rounded-md cursor-pointer",onClick:a=>H(e)},null,8,Ea))),128))])):u("",!0),r(Ia,{commentId:l.id,"like-count":l.likeCount,"is-like":l.isLike,onReply:R},null,8,["commentId","like-count","is-like"]),l.children.length>0?(o(),i("div",Qa,[(o(!0),i(s,null,m(l.children.slice(0,V.value===l.id?l.children.length:2),b=>{var f;return o(),i("div",{key:b.id,class:"reply-item"},[c("div",Wa,[r(L,{src:b.author.headImg,alt:b.author.nickname,size:24,class:"flex-shrink-0",onClick:y(e=>H(b.author.headImg),["stop"])},null,8,["src","alt","onClick"]),c("div",Xa,[c("div",{class:"flex items-center mb-1",onClick:e=>a.$router.push({name:"mobileUserPanel",query:{userId:b.author.id}})},[c("span",{class:"font-medium mr-2",onClick:e=>D.value=`${l.id}-${b.id}`},v(b.author.nickname),9,Ga),b.author.id==(null==(f=e.postData)?void 0:f.author.id)?(o(),n(P,{key:0,size:"sm",bgColor:"#FFADBB",class:"text-xs px-1 rounded"},{default:d(()=>[g(v(a.$t("b.tie-zhu")),1)]),_:1})):u("",!0),c("span",{class:"text-gray-content text-xs",onClick:e=>D.value=`${l.id}-${b.id}`},v(b.createdAt),9,Ja),c("div",{class:"flex flex-1 justify-end",onClick:e=>D.value=`${l.id}-${b.id}`},[r(ge,{position:"bottom",noActivation:"",noPd:"",class:p(["transition-opacity",{"opacity-100":D.value==`${l.id}-${b.id}`,"opacity-0 group-hover/item:opacity-100":D.value!=`${l.id}-${b.id}`}]),icon:h(oe)},{default:d(()=>[r(Va,{onUpdateComment:t[1]||(t[1]=e=>O(1)),"comment-id":b.id,uid:b.author.id},null,8,["comment-id","uid"])]),_:2},1032,["class","icon"])],8,Ya)],8,Za),c("div",Ka,[b.toAuthor?(o(),i("span",{key:0,class:"text-active mr-2",onClick:e=>a.$router.push({name:"mobileUserPanel",query:{userId:b.toAuthor.id}})}," @"+v(b.toAuthor.nickname),9,et)):u("",!0),c("span",{onClick:e=>D.value=`${l.id}-${b.id}`,innerHTML:b.content,class:"w-full break-all"},null,8,at)]),b.image?(o(),i("div",tt,[(o(!0),i(s,null,m(b.image,(e,t)=>(o(),i("img",{key:t,src:e,alt:a.$t("d.ping-lun-tu-pian"),class:"w-20 h-20 object-cover rounded-md cursor-pointer",onClick:a=>H(e)},null,8,lt))),128))])):u("",!0),r(Ia,{commentId:l.id,"to-comment-id":b.id,"like-count":b.likeCount,"is-like":b.isLike,onReply:R},null,8,["commentId","to-comment-id","like-count","is-like"])])])])}),128)),l.children.length>2?(o(),n(A,{key:0,icon:V.value===l.id?h(se):h(ne),activation:"",noBg:"",class:"text-sm flex items-center",onClick:e=>V.value=V.value===l.id?0:l.id},{default:d(()=>[g(v(V.value===l.id?a.$t("b.shou-qi-hui-fu"):a.$t("b.cha-kan-commentchildrenlength-tiao-hui-fu",[l.children.length])),1)]),_:2},1032,["icon","onClick"])):u("",!0)])):u("",!0)])])])}),128))]),c("div",it,[r(A,{class:"px-4 py-2 rounded-md mx-auto",Border:"",disabled:T.value.page>=Math.ceil(T.value.total/T.value.limit),onClick:t[2]||(t[2]=e=>O(T.value.page+1))},{default:d(()=>[g(v(U.value),1)]),_:1},8,["disabled"])]),t[6]||(t[6]=c("div",{class:"h-20"},null,-1))]),r(S,{modelValue:$.value,"onUpdate:modelValue":t[5]||(t[5]=e=>$.value=e)},{default:d(()=>[c("div",ot,[r(z,{src:j.value,onClickOutside:t[3]||(t[3]=e=>$.value=!1)},null,8,["src"]),c("button",{class:"absolute z-[10] top-[1rem] right-[1rem] rounded-full w-10 h-10 border border-error hover:border-active/80 text-error hover:text-active/80",onClick:t[4]||(t[4]=e=>$.value=!1)},[r(h(ae),{class:"mx-auto"})])])]),_:1},8,["modelValue"]),c("div",st,[r(ta,{onSubmit:R,submitText:a.$t("b.fa-biao-ping-lun"),placeholder:a.$t("b.shuo-dian-shi-mo")},null,8,["submitText","placeholder"])])],64))}}),ut=e({__name:"MobileArticleActions",props:{postData:{type:Object,required:!0}},emits:["updatePost"],setup(e,{emit:t}){const{t:l}=a(),i=t;return(a,t)=>e.postData?(o(),n(B,{key:0,class:"justify-evenly",noPg:"",noCol:""},{default:d(()=>[r(A,{isCol:"",icon:h(ue),"icon-size":24},{default:d(()=>[g(v(e.postData.commentCount),1)]),_:1},8,["icon"]),r(A,{isCol:"",icon:h(ie),"icon-size":24,class:p({"text-like":e.postData.isLiked}),onClick:t[0]||(t[0]=a=>{return t=e.postData.id,void ke(l,t,()=>{i("updatePost",t)});var t})},{default:d(()=>[g(v(e.postData.likeCount),1)]),_:1},8,["icon","class"]),r(A,{isCol:"",icon:h(re),"icon-size":24,class:p({"text-bad":e.postData.isBaded}),onClick:t[1]||(t[1]=a=>{return t=e.postData.id,void _e(l,t,()=>{i("updatePost",t)});var t})},{default:d(()=>[g(v(e.postData.badCount),1)]),_:1},8,["icon","class"])]),_:1})):u("",!0)}}),rt={class:"px-4"},dt={class:"flex justify-between items-center text-sm h-12"},ct={key:0},vt={class:"text-red-500 text-lg font-bold"},mt={class:"text-gray-content mt-2"},pt={key:1},gt={class:"text-red-500 text-lg font-bold"},ht={class:"text-gray-content mt-2"},bt={key:2,class:"flex flex-col w-full gap-6 pr-1 pt-4"},ft={class:"text-lg font-bold"},xt={class:"flex flex-wrap gap-x-1 items-center"},yt={class:"text-background-content"},kt={class:"tiptap"},_t=["innerHTML"],Ct={class:"flex flex-col gap-2"},wt={key:3,class:"flex flex-col items-center"},$t={class:"text-xl font-bold my-4"},zt={class:"text-gray-content mb-4"},jt={class:"relative w-screen h-[100dvh] overflow-hidden"},It={class:"flex"},qt={class:"text-xl mb-4 mr-4"},Dt={key:0,class:"text-error pt-1"},At={class:"text-active"},Lt={class:"flex gap-4 justify-end"},Vt=e({__name:"MobilePostDetails",setup(e){const m=k(),f=_(),$=t(null),j=t([]),I=t(!1),P=t(""),U=t(null),M=ve(),T=t(!1),N=t(!1),H=t(""),{t:O}=a(),R=b(),E=()=>{N.value&&$.value&&(!1!==M.isLogin?H.value.trim()?je(O,1,$.value.id,H.value,()=>{N.value=!1,H.value=""}):R.error(O("t.ju-bao-li-you-bu-neng-wei-kong")):R.error(O("t.qing-xian-deng-lu")))},Q=()=>{window.history.length>2?window.history.back():f.push({name:"Home"})},W=()=>{const e=U.value;if(!e)return;e.querySelectorAll("img").forEach(e=>{e.style.cursor="pointer",e.addEventListener("click",()=>X(e.src))})},X=e=>{I.value=!0,P.value=F(e)},Z=async e=>{const{post:a,toc:t}=await Ce(e,O);$.value=a,j.value=t};return x(async()=>{const e=m.params.postId,a=await Ce(+e,O);a.post?($.value=a.post,j.value=a.toc,C(()=>{W()})):T.value=!0}),w(()=>{$.value=null,j.value=[],T.value=!1}),l(()=>m.params,async e=>{Z(+e.postId)}),l($,async()=>{await C(),W()}),(e,a)=>{var t,l,m,b,f,x;return o(),i(s,null,[c("div",rt,[c("div",dt,[r(A,{noPd:"",icon:h(de),"icon-size":22,onClick:Q},null,8,["icon"]),r(ge,{icon:h(ce),"icon-size":22,position:"bottom-left",noPd:"",className:"p-1.5"},{default:d(({close:t})=>[r(B,{noPg:"",class:"p-1 w-26"},{default:d(()=>[$.value?(o(),i(s,{key:0},[r(A,{noBg:"",onClick:a[0]||(a[0]=e=>N.value=!0),class:"break-all"},{default:d(()=>[g(v(e.$t("b.ju-bao")),1)]),_:1}),$.value.author.id==h(M).userInfo.id?(o(),n(A,{key:0,noBg:"",onClick:a=>{var l;return e.$router.push({name:"publishPost",params:{postId:null==(l=$.value)?void 0:l.id}}),t()}},{default:d(()=>[g(v(e.$t("b.bian-ji")),1)]),_:1},8,["onClick"])):u("",!0),$.value&&h(he)([1,2,5])?(o(),n(A,{key:1,noBg:"",class:p({" text-green":1==$.value.disabled," text-error":0==$.value.disabled}),onClick:a[1]||(a[1]=e=>{return a=$.value.id,t=$.value.disabled,void(he([1,2,5])&&we(O,a,1==t?0:1,()=>{Z(a)}));var a,t})},{default:d(()=>[g(v(0==$.value.disabled?e.$t("b.shan-chu"):e.$t("b.hui-fu")),1)]),_:1},8,["class"])):u("",!0),$.value&&h(he)([1,2,5])?(o(),n(A,{key:2,noBg:"",class:p(["group",{"text-primary":0==$.value.top,"text-warning":0!=$.value.top}]),onClick:a[2]||(a[2]=e=>{return a=$.value.id,t=$.value.top,void ze(O,a,0==t?1:0,()=>{Z(a)});var a,t})},{default:d(()=>[g(v(0==$.value.top?e.$t("b.zhi-ding"):e.$t("b.qu-xiao-zhi-ding")),1)]),_:1},8,["class"])):u("",!0),$.value.creatorId==h(M).userInfo.id?(o(),n(A,{key:3,class:p({"text-error":1==$.value.visible,"text-success":2==$.value.visible}),"icon-size":24,onClick:a[3]||(a[3]=e=>{return a=$.value.id,t=$.value.visible,void $e(O,a,1==t?0:1,()=>{Z(a)});var a,t})},{default:d(()=>[g(v(1==$.value.visible?e.$t("b.xia-jia"):e.$t("b.fa-bu")),1)]),_:1},8,["class"])):u("",!0)],64)):u("",!0)]),_:2},1024)]),_:1},8,["icon"])]),2==(null==(t=$.value)?void 0:t.status)||1==(null==(l=$.value)?void 0:l.disabled)?(o(),i("div",ct,[c("div",vt,v(e.$t("d.gai-tie-zi-yi-bei-feng-jin-huo-jin-yong")),1),c("div",mt,v(e.$t("d.dang-qian-zheng-zai-shi-yong-guan-li-yuan-quan-xian-cha-kan")),1)])):u("",!0),0==(null==(m=$.value)?void 0:m.visible)?(o(),i("div",pt,[c("div",gt,v(e.$t("d.gai-tie-zi-yi-xia-jia")),1),c("div",ht,v(e.$t("d.dang-qian-zheng-zai-shi-yong-guan-li-yuan-quan-xian-cha-kan")),1)])):u("",!0),T.value?(o(),i("div",wt,[c("h2",$t,v(e.$t("d.tie-zi-jia-zai-shi-bai")),1),a[13]||(a[13]=c("img",{src:D,alt:"Error",class:"w-auto h-40 mb-4 mx-auto"},null,-1)),c("p",zt,v(e.$t("d.ke-neng-shi-tie-zi-bu-cun-zai-huo-yi-bei-shan-chu-nin-ke-yi-chang-shi-shua-xin-ye-mian-huo-fan-hui-shang-yi-ye")),1),r(A,{onClick:Q,class:"mt-2",Border:""},{default:d(()=>[g(v(e.$t("b.fan-hui-shang-yi-ye")),1)]),_:1})])):(o(),i("div",bt,[c("h3",ft,v(null==(b=$.value)?void 0:b.title),1),$.value?(o(),i("div",{key:0,class:"flex gap-2 items-center",onClick:a[5]||(a[5]=a=>e.$router.push({name:"mobileUserPanel",query:{userId:$.value.author.id}}))},[r(L,{src:$.value.author.headImg||"",alt:$.value.author.nickname,size:28,onClick:a[4]||(a[4]=y(e=>X($.value.author.headImg),["stop"]))},null,8,["src","alt"]),c("div",xt,[c("span",yt,v($.value.author.nickname),1),r(V,{user:$.value.author,size:"sm"},null,8,["user"])])])):u("",!0),c("div",kt,[c("div",{ref_key:"htmlContainer",ref:U,innerHTML:null==(f=$.value)?void 0:f.content},null,8,_t),a[12]||(a[12]=c("div",{class:"border-t border-gray my-8"},null,-1)),c("div",Ct,[r(ut,{postData:$.value,onUpdatePost:Z},null,8,["postData"]),r(q,{postData:$.value},null,8,["postData"]),r(We,{postData:$.value},null,8,["postData"]),$.value&&2==$.value.type?(o(),n($a,{key:0,postId:null==(x=$.value)?void 0:x.id,class:"mb-4"},null,8,["postId"])):u("",!0)])]),r(nt,{postData:$.value},null,8,["postData"])]))]),r(S,{modelValue:I.value,"onUpdate:modelValue":a[8]||(a[8]=e=>I.value=e)},{default:d(()=>[c("div",jt,[r(z,{src:P.value,onClickOutside:a[6]||(a[6]=e=>I.value=!1)},null,8,["src"]),c("button",{class:"absolute z-[10] top-[1rem] right-[1rem] rounded-full w-10 h-10 border border-error hover:border-active/80 text-error hover:text-active/80",onClick:a[7]||(a[7]=e=>I.value=!1)},[r(h(ae),{class:"mx-auto"})])])]),_:1},8,["modelValue"]),r(S,{modelValue:N.value,"onUpdate:modelValue":a[11]||(a[11]=e=>N.value=e)},{default:d(()=>[r(B,{class:"p-6"},{default:d(()=>{var t;return[c("div",It,[c("h3",qt,v(e.$t("d.ju-bao-tie-zi")),1),h(M).isLogin?u("",!0):(o(),i("div",Dt,v(e.$t("t.qing-xian-deng-lu-hou-zai-cao-zuo")),1))]),c("div",null,[g(v(e.$t("t.tie-zi-biao-ti"))+" ",1),c("span",At,v(null==(t=$.value)?void 0:t.title),1)]),c("div",null,v(e.$t("d.ni-que-ding-yao-ju-bao-ci-ping-lun-ma-qing-ti-gong-ju-bao-li-you-wo-men-hui-jin-kuai-chu-li")),1),r(me,{class:"mt-4",multiline:"",placeholder:e.$t("d.qing-shu-ru-ju-bao-li-you"),rows:4,maxlength:200,modelValue:H.value,"onUpdate:modelValue":a[9]||(a[9]=e=>H.value=e)},null,8,["placeholder","modelValue"]),c("div",Lt,[r(A,{class:"px-4",onClick:E,Border:""},{default:d(()=>[g(v(e.$t("b.ti-jiao")),1)]),_:1}),r(A,{class:"px-4",onClick:a[10]||(a[10]=e=>N.value=!1),Border:""},{default:d(()=>[g(v(e.$t("b.qu-xiao")),1)]),_:1})])]}),_:1})]),_:1},8,["modelValue"])],64)}}});export{Vt as default};
