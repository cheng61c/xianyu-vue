import{_ as e}from"./Card.vue_vue_type_script_setup_true_lang-bjhPCac0.js";import{v as a,r as t,B as l,I as n,o as s,D as o,q as u,f as r,A as i,F as c,y as v,g as d,U as p,E as m,x as h,W as g,z as f,C as b,w as y,u as w,Y as x,Z as _,J as k}from"./lucide-vue-next-DYmFLWJU.js";import{u as C}from"./store-global/deviceStore-KKN3G4DG.js";import{_ as I}from"./index-Cb4mdASZ.js";import{_ as j}from"./ScButton.vue_vue_type_script_setup_true_lang-BX58BrIO.js";import{S as z,k as D}from"./store-module/admin/service-B8wAbs3A.js";import{I as M,X as S}from"./vendor-lucide-DYSNolYz.js";const Y="/xianyu-vue/assets/wow-B8m_h0L8.webp",X={class:"text-lg font-bold mb-2"},q={class:"text-blue-600"},$=a({__name:"Dependencies",props:{postData:{type:Object,required:!0}},setup:a=>(p,m)=>{const h=t("Avatar"),g=t("RouterLink");return a.postData&&a.postData.dependencies.length>0?(s(),l(e,{key:0},{default:o(()=>[u("h3",X,i(p.$t("d.qian-zhi-yi-lai")),1),(s(!0),r(c,null,v(a.postData.dependencies,e=>(s(),r("div",{key:e.id,class:"flex gap-2 items-center"},[e.cover?(s(),l(h,{key:0,src:e.cover||"",alt:e.id,size:32},null,8,["src","alt"])):n("",!0),d(g,{to:{name:"postDetails",params:{postId:e.id}}},{default:o(()=>[u("span",q,i(e.title),1)]),_:2},1032,["to"])]))),128))]),_:1})):n("",!0)}}),B=["value","checked","disabled","onChange"],U=a({__name:"ReadonlyRating",props:{value:{type:Number,required:!0},colorClass:{type:String,default:"bg-yellow-500"},size:{type:String,default:"sm",validator:e=>["xs","sm","md","lg"].includes(e)},readonly:{type:Boolean,default:!0}},emits:["update:value"],setup(e,{emit:a}){const t=e,l=a,n=`rating-int-${Math.random().toString(36).substring(2,10)}`,o=p(()=>{switch(t.size){case"xs":return"rating-xs";case"sm":return"rating-sm";case"lg":return"rating-lg";default:return"rating-md"}});return(a,i)=>(s(),r("div",{class:m(["rating",o.value,{"pointer-events-none":e.readonly}])},[(s(),r(c,null,v(5,a=>{return u("input",{key:a,type:"radio",value:a,name:n,class:m(["mask mask-star",[t.colorClass]]),checked:(s=a,s===t.value),disabled:e.readonly,onChange:e=>{return n=a,void(t.readonly||l("update:value",n));var n}},null,42,B);var s}),64))],2))}}),T=["src","alt"],W=I(a({__name:"ScZoomableImage",props:{src:{}},emits:["click-outside"],setup(e,{emit:a}){const t=C(),l=e.src.replace(/!\/fwfh\/368x238$/,""),n=a,o=h(1),i=h(0),c=h(0),v=h(!1),d=h(0),m=h(0),y=h(null),w=h(null),x=h(null),_=h("fit-width"),k=p(()=>{const e=`translate(${i.value}px, ${c.value}px) scale(${o.value})`,a="fit-width"===_.value?{maxWidth:1==t.device?"100vw":"90vw",height:"auto"}:{maxHeight:1==t.device?"100dvh":"90dvh",width:"auto"};return{transform:e,transition:v.value?"none":"transform 0.2s ease",...a}}),I=()=>{n("click-outside")},j=()=>{if(!y.value||!w.value)return;const e=y.value.naturalWidth/y.value.naturalHeight,a=w.value.clientWidth/w.value.clientHeight;_.value=e>a?"fit-width":"fit-height",o.value=1,i.value=0,c.value=0},z=e=>{const a=-e.deltaY,t=o.value+(a>0?.1:-.1);o.value=Math.min(Math.max(t,.2),5)},D=e=>{v.value=!0,d.value=e.clientX,m.value=e.clientY},M=e=>{if(!v.value)return;const a=e.clientX-d.value,t=e.clientY-m.value;i.value+=a,c.value+=t,d.value=e.clientX,m.value=e.clientY},S=()=>{v.value=!1,x.value=null},Y=e=>{1===e.touches.length?(v.value=!0,d.value=e.touches[0].clientX,m.value=e.touches[0].clientY):2===e.touches.length&&(v.value=!1,x.value=$(e.touches))},X=e=>{if(1===e.touches.length&&v.value){const a=e.touches[0].clientX-d.value,t=e.touches[0].clientY-m.value;i.value+=a,c.value+=t,d.value=e.touches[0].clientX,m.value=e.touches[0].clientY}else if(2===e.touches.length){const a=$(e.touches);if(null!==x.value){const e=(a-x.value)/200,t=o.value+e;o.value=Math.min(Math.max(t,.2),5)}x.value=a}},q=()=>{o.value=1,i.value=0,c.value=0},$=e=>{const a=e[0].clientX-e[1].clientX,t=e[0].clientY-e[1].clientY;return Math.sqrt(a*a+t*t)};return(e,a)=>(s(),r("div",{ref_key:"container",ref:w,class:"w-full h-full overflow-hidden flex justify-center items-center touch-none select-none",onWheel:g(z,["prevent"]),onMousedown:D,onMousemove:M,onMouseup:S,onMouseleave:S,onTouchstart:Y,onTouchmove:X,onTouchend:S,onDblclick:q,onClick:I},[u("img",{ref_key:"imgRef",ref:y,src:b(l),alt:e.$t("t.tu-pian-yu-lan"),onDblclick:a[0]||(a[0]=g(()=>{},["prevent"])),onMousedown:a[1]||(a[1]=g(()=>{},["prevent"])),draggable:!1,class:"select-none w-auto h-full object-contain z-10",style:f(k.value),onLoad:j,onClick:a[2]||(a[2]=g(()=>{},["stop"]))},null,44,T)],544))}}),[["__scopeId","data-v-147731c7"]]),R=(e,a,t)=>{if(0===e||0===a.totalCount)return{label:t("t.zan-wu-ping-ce"),colorClass:"text-gray-400"};const l=((a.scoreDistribution[4]||0)+(a.scoreDistribution[5]||0))/e;return e<10?{label:t("t.ping-ce-guo-shao"),colorClass:"text-gray-400"}:l>=.95?{label:t("t.hao-ping-ru-chao"),colorClass:"text-green-600"}:l>=.9?{label:t("t.te-bie-hao-ping"),colorClass:"text-green-500"}:l>=.8?{label:t("t.duo-ban-hao-ping"),colorClass:"text-green-400"}:l>=.4?{label:t("t.bao-bian-bu-yi"),colorClass:"text-yellow-500"}:l>=.2?{label:t("t.duo-ban-cha-ping"),colorClass:"text-red-400"}:{label:t("tcha-ping-ru-chao"),colorClass:"text-red-600"}},A={class:"comment-input"},H=["placeholder"],L={class:"flex justify-between items-center"},N={key:0},Z={key:1,class:"w-2"},E={class:"flex flex-wrap gap-3"},F=["src"],J={key:1,class:"skeleton w-full h-full bg-gray-200"},O=["onClick"],P=I(a({__name:"CommentInput",props:{commentId:{type:Number,required:!1},toCommentId:{type:Number,required:!1},submitText:{type:String},placeholder:{type:String},noImg:{type:Boolean,default:!1}},emits:["submit"],setup(e,{emit:a}){const{t:t}=y(),l=w(),n=h(!1),p=e,m=a,g=h(""),f=h(null),C=h([]),I=()=>{f.value?.click()},Y=async e=>{const a=e.target.files;if(!a)return;l.info(t("d.zheng-zai-shang-chuan-tu-pian")),n.value=!0;const s=Array.from(a),o=[];for(const n of s){const e={url:"",viewUrl:"",loading:!0};C.value.push(e);const a=C.value.length-1,s=(async()=>{try{const e=await z(n,6),t=D(e.data.data.url);C.value[a]={url:t,viewUrl:e.data.data.viewUrl,loading:!1}}catch(e){l.error(t("t.tu-pian-shang-chuan-shi-bai-filename",[n.name])),C.value.splice(a,1)}})();o.push(s)}await Promise.allSettled(o),n.value=!1,f.value&&(f.value.value="")},X=()=>{if(""===g.value.trim())return void l.error(t("t.ping-lun-nei-rong-bu-neng-wei-kong"));const e=C.value.filter(e=>!e.loading).map(e=>e.url);m("submit",g.value,e,p.commentId,p.toCommentId,()=>{g.value="",C.value=[]})};return(a,t)=>(s(),r("div",A,[x(u("textarea",{"onUpdate:modelValue":t[0]||(t[0]=e=>g.value=e),placeholder:e.placeholder,class:"w-full p-3 border border-gray rounded-md focus:outline-none focus:ring-2 focus:ring-active focus:border-transparent"},null,8,H),[[_,g.value]]),u("div",L,[!1===e.noImg?(s(),r("div",N,[d(j,{icon:b(M),"icon-size":18,Border:"",onClick:I},null,8,["icon"]),u("input",{ref_key:"fileInput",ref:f,type:"file",accept:"image/*",multiple:"",class:"hidden",onChange:Y},null,544)])):(s(),r("div",Z)),d(j,{onClick:X,activation:"",class:"hover:bg-active/60"},{default:o(()=>[k(i(e.submitText),1)]),_:1})]),u("div",E,[(s(!0),r(c,null,v(C.value,(e,a)=>(s(),r("div",{key:a,class:"relative w-20 h-20 border border-gray-300 rounded-lg overflow-hidden"},[e.loading?(s(),r("div",J)):(s(),r("img",{key:0,src:e.viewUrl||e.url,alt:"uploaded",class:"w-full h-full object-cover"},null,8,F)),u("button",{class:"absolute top-0 right-0 text-active-content bg-gray/60 rounded-bl px-1 hover:bg-error/80 hover:cursor-pointer",onClick:e=>(e=>{C.value.splice(e,1)})(a)},[d(b(S),{size:16})],8,O)]))),128))])]))}}),[["__scopeId","data-v-35dc90de"]]);export{P as C,W as Z,U as _,$ as a,Y as b,R as g};
