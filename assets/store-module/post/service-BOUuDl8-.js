import{u as e}from"../../lucide-vue-next-DYmFLWJU.js";import{k as t,l as a,n as s,f as o,o as n,p as r,q as i,r as c,t as l,u,v as p,w as d,x as g,y as m}from"../admin/service-B8wAbs3A.js";import{u as h}from"../user/userStore-CYZokpSa.js";import{u as b}from"./postStore-7aBFqooK.js";import{A as f,a as y}from"../../vendor-lucide-DYSNolYz.js";const v=e=>{const a=/<img[^>]+src=["']([^"']+)["']/g,s=[];let o;for(;null!==(o=a.exec(e));){const e=o[1];s.push(t(e))}return s},T=e=>e?"string"!=typeof e?String(e).replace(/<[^>]*>/g,""):e.replace(/<[^>]*>/g,""):"",A=e=>{if(!e)return"";const a=function s(e){const t=document.createElement("div");function a(e){if(e.nodeType===Node.ELEMENT_NODE&&"A"!==e.nodeName)Array.from(e.childNodes).forEach(a);else if(e.nodeType===Node.TEXT_NODE){const a=e.textContent,s=/(https?:\/\/[^\s/$.?#].[^\s]*)/gi;let o=e.parentNode,n=!1;for(;o!==t&&null!==o;){if("A"===o.nodeName){n=!0;break}o=o.parentNode}if(!n&&s.test(a)){const t=a.replace(s,'<a href="$1" target="_blank" rel="noopener" class="text-active">$1</a>');if(t!==a){const a=document.createElement("span");a.innerHTML=t,e.parentNode.replaceChild(a,e)}}}}return t.innerHTML=e,Array.from(t.childNodes).forEach(a),t.innerHTML}(String(e).replace(/<link[^>]+rel=["']stylesheet["'][^>]*>/gi,"").replace(/<script[^>]*>([\s\S]*?)<\/script>/gi,"").replace(/<style[^>]*>([\s\S]*?)<\/style>/gi,""));return a.replace(/<img([^>]+)src=["']([^"']+)["']/g,(e,a,s)=>`<img${a}src="${t(s.replace(/^.*api/,""))}"`)};const x=e(),j=b(),N=h(),P=e=>[{name:e("nav.zi-yuan-xia-zai"),pathName:"modList",params:{plateId:0},type:2},{name:e("nav.jiao-liu-tie-zi"),pathName:"postList",params:{plateId:0},type:1}],z=e=>[{value:1,label:e("b.cun-dang")},{value:2,label:e("b.jia-ju")},{value:3,label:e("b.cai-zhi")},{value:4,label:e("b.pi-fu")},{value:5,label:e("b.mo-zu")},{value:8,label:e("b.lian-ji-mo-zu")},{value:7,label:e("b.qi-ta")}],q=e=>[{value:0,label:e("b.quan-bu")},{value:1,label:e("b.cun-dang")},{value:2,label:e("b.jia-ju")},{value:3,label:e("b.cai-zhi")},{value:4,label:e("b.pi-fu")},{value:5,label:e("b.mo-zu")},{value:8,label:e("b.lian-ji-mo-zu")},{value:7,label:e("b.qi-ta")}],C=e=>[{value:1,label:e("b.zui-xin"),icon:f},{value:2,label:e("b.zui-zao"),icon:y}],k=async e=>{const t=P(e).find(e=>e.pathName===j.currentPlate.currentRouteName)?.type||1;a().then(a=>{const s=a.data;if(200!==s.code)return x.error(e("t.huo-qu-ban-kuai-shi-bai"));const o=s.data;j.plate[j.currentPlate.currentRouteName]=o.filter(e=>e.type===t)}).catch(t=>{x.error(e("t.huo-qu-ban-kuai-shi-bai"))})},L=(e,t,a)=>{a.push({name:t.name,params:{plateId:e}}),j.currentPlate.activation=e},E=async(e,t,a)=>{if(j.isSearch&&j.searchText&&j.searchText.trim())return void S(j.searchText,!1,"0",t,a);const r={type:"postList"==t.name?1:2};0!==j.orderType&&(r.orderType=j.orderType),0!==e&&(r.plateId=e),0!==j.fileType&&2==r.type&&(r.fileTypes=String(j.fileType)),r.page=j.postPage.page,r.limit=j.postPage.limit,s(r).then(e=>{const t=e.data;200===t.code&&(j.post=t.data.list.map(e=>(e.images=v(e.content),e.content=A(e.content),e.createdAt=o(e.createdAt,a),e.updatedAt=o(e.updatedAt,a),e.likeCount=n(e.likeCount),e.commentCount=n(e.commentCount),e.views=n(e.views),e)),j.postPage.page=t.data.page,j.postPage.total=t.data.total,j.postPage.limit=t.data.limit)})},S=(e,t=!0,a="0",n,r)=>{t&&(j.postPage.page=1),j.searchText=""==e?"":e.trim(),j.isSearch=!0;const i={type:"postList"==n.name?1:2};0!==j.orderType&&(i.orderType=j.orderType),j.plateId&&0!==j.plateId&&(i.plateId=j.plateId),a&&"0"!=a&&2==i.type&&(i.fileTypes=a),""!=j.searchText&&(i.title=j.searchText),i.page=j.postPage.page,i.limit=j.postPage.limit,s(i).then(e=>{const t=e.data;200===t.code&&(j.post=t.data.list.map(e=>(e.images=v(e.content),e.createdAt=o(e.createdAt,r),e.updatedAt=o(e.updatedAt,r),e)),j.postPage.page=t.data.page,j.postPage.total=t.data.total,j.postPage.limit=t.data.limit)})},I=async(e,t)=>(j.postData=null,j.tocList=[],j.errorPage=!1,r(e).then(async e=>{const a=e.data.data;a.content=i(A(await c(a.content))),a.createdAt=o(a.createdAt,t),a.updatedAt=o(a.updatedAt,t),a.commentCount=n(a.commentCount),a.likeCount=n(a.likeCount),a.badCount=n(a.badCount),a.postVersions=a.postVersions.map(e=>({...e,content:i(A(e.content)),createdAt:o(e.createdAt,t)}));const s=function r(e){const t=(new DOMParser).parseFromString(e,"text/html").querySelectorAll("h1, h2, h3, h4, h5, h6"),a=[];return t.forEach((e,t)=>{const s=parseInt(e.tagName.substring(1)),o=e.textContent?.trim()||`标题 ${t}`,n=e.getAttribute("id")||`heading-${t}`;a.push({level:s,text:o,id:n})}),a}(a.content);return j.tocList=s,j.postData=a,j.errorPage=!1,{post:a,toc:s}}).catch(e=>(x.error(e.msg),j.errorPage=!0,{post:null,toc:[]}))),$=(e,t,a,s)=>{l({id:t,disabled:a}).then(t=>{200===t.data.code&&(s&&s(),x.success(e("t.cao-zuo-cheng-gong")))}).catch(t=>{x.error(e("t.qing-qiu-shi-bai")+t.msg)})},w=(e,t,a,s)=>{u({id:t,visible:a}).then(t=>{200===t.data.code&&(s&&s(),x.success(e("t.cao-zuo-cheng-gong")))}).catch(t=>{x.error(e("t.qing-qiu-shi-bai")+t.msg)})},D=(e,t,a,s)=>{p({id:t,top:a}).then(t=>{200===t.data.code&&(s&&s(),x.success(e("t.cao-zuo-cheng-gong")))}).catch(t=>{x.error(e("t.qing-qiu-shi-bai")+t.msg)})},M=(e,t,a,s,o)=>{d({targetType:t,targetId:a,reason:s}).then(t=>{200===t.data.code&&(o&&o(),x.success(e("t.ju-bao-yi-ti-jiao-wo-men-hui-jin-kuai-chu-li")))}).catch(t=>{x.error(e("t.ju-bao-shi-bai")+t.msg)})},H=(e,t,a)=>{N.isLogin?g(t).then(()=>{a&&a(),x.success(e("t.cao-zuo-cheng-gong"))}).catch(e=>{}):x.error(e("t.qing-xian-deng-lu"))},O=(e,t,a)=>{N.isLogin?m(t).then(()=>{a&&a(),x.success(e("t.cao-zuo-cheng-gong"))}).catch(e=>{}):x.error(e("t.qing-xian-deng-lu"))};export{k as a,E as b,q as c,C as d,v as e,A as f,P as g,L as h,O as i,I as j,$ as k,H as l,w as m,D as n,M as o,z as p,T as r,S as s};
